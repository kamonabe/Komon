---
title: ディスク使用量の増加トレンド予測 - 要件定義
feature: disk-trend-prediction
status: implemented
created: 2025-11-23
updated: 2025-11-25
---

# ディスク使用量の増加トレンド予測 - 要件定義書

## 概要

本機能は、過去のディスク使用量データから将来の使用量を予測し、ディスク容量が逼迫する前にユーザーに警告を発する機能です。84%から90%に急激にジャンプするケースに対応し、事前の計画的な対応を可能にします。

## 用語集

- **Komon**: システムリソース監視ツール
- **ディスク使用率**: ディスクの総容量に対する使用済み容量の割合（パーセンテージ）
- **線形回帰**: 過去のデータから傾向を分析し、将来の値を予測する統計手法
- **トレンド予測**: 過去のデータパターンから将来の傾向を推定すること
- **急激な変化**: 前日比で10%以上のディスク使用率増加
- **usage_history**: ディスク使用率の履歴データを保存するディレクトリ（`data/usage_history/`）
- **advise コマンド**: システムの状態を分析し、ユーザーに助言を提供するKomonのコマンド
- **週次レポート**: 毎週定期的に送信されるシステム健全性レポート

## 受入基準

### [AC-001] データ読み込みと前処理

**ユーザーストーリー**: システム管理者として、ディスク容量が逼迫する前に事前に対応できるよう、将来のディスク使用量を予測したい。

#### 受入基準

1. WHEN Komonが過去7日分のディスク使用率データを取得する場合、THEN Komonは `usage_history` から日次の平均値を計算しなければならない
2. WHEN 過去7日分のデータが7件未満の場合、THEN Komonは予測を実行せず、データ不足のメッセージを表示しなければならない
3. WHEN 過去7日分のデータが全て同一値の場合、THEN Komonは増加率ゼロとして処理しなければならない
4. WHEN ディスク使用率データに欠損日がある場合、THEN Komonは利用可能なデータのみを使用して予測を実行しなければならない
5. WHEN 取得したデータが数値として不正な場合、THEN Komonはエラーを記録し、予測をスキップしなければならない

### [AC-002] 線形回帰による予測計算

**ユーザーストーリー**: システム管理者として、ディスクがいつ危険な水準に達するかを知りたい。

#### 受入基準

1. WHEN Komonが線形回帰を実行する場合、THEN Komonは最小二乗法を使用して傾きを算出しなければならない
2. WHEN 傾きが正の値（増加傾向）の場合、THEN Komonは90%到達予測日を計算しなければならない
3. WHEN 傾きがゼロまたは負の値（横ばいまたは減少傾向）の場合、THEN Komonは90%到達予測を「該当なし」として処理しなければならない
4. WHEN 現在のディスク使用率が既に90%以上の場合、THEN Komonは「既に危険水準」として即座に警告しなければならない
5. WHEN 予測日が100年以上先の場合、THEN Komonは「当面は安全」として処理しなければならない

### [AC-003] 急激な変化の検出

**ユーザーストーリー**: システム管理者として、通常と異なる急激なディスク使用量の増加を早期に検知したい。

#### 受入基準

1. WHEN Komonが前日比を計算する場合、THEN Komonは最新日と前日のディスク使用率の差分を算出しなければならない
2. WHEN 前日比が10%以上の増加の場合、THEN Komonは「急激な変化」として警告を発しなければならない
3. WHEN 前日比が10%未満の増加の場合、THEN Komonは通常の増加として処理しなければならない
4. WHEN 前日比が減少（負の値）の場合、THEN Komonは急激な変化の警告を発してはならない
5. WHEN 前日のデータが存在しない場合、THEN Komonは前日比の計算をスキップしなければならない

### [AC-004] 予測結果のメッセージ生成

**ユーザーストーリー**: システム管理者として、予測結果を分かりやすい形で確認したい。

#### 受入基準

1. WHEN Komonが予測メッセージを生成する場合、THEN Komonは増加トレンドの説明を含めなければならない
2. WHEN 90%到達予測日が算出された場合、THEN Komonは「あとN日で90%に到達」という形式でメッセージを生成しなければならない
3. WHEN 急激な変化が検出された場合、THEN Komonは「通常と異なる急激な増加」という警告をメッセージに含めなければならない
4. WHEN 推奨アクションが存在する場合、THEN Komonはログクリーンアップコマンド等の具体的な提案を含めなければならない
5. WHEN 予測結果が「安全」の場合、THEN Komonは安心できるメッセージを生成しなければならない

### [AC-005] adviseコマンドへの統合

**ユーザーストーリー**: システム管理者として、`komon advise` コマンドで予測結果を確認したい。

#### 受入基準

1. WHEN ユーザーが `komon advise` コマンドを実行する場合、THEN Komonはディスク使用量の予測結果を表示しなければならない
2. WHEN 予測データが存在しない場合、THEN Komonはデータ不足のメッセージを表示しなければならない
3. WHEN 予測計算中にエラーが発生した場合、THEN Komonはエラーメッセージを表示し、他の助言は継続して表示しなければならない
4. WHEN 予測結果の表示フォーマットは、THEN 他の助言項目と統一された形式でなければならない
5. WHEN 予測結果が複数の警告を含む場合、THEN Komonは優先度の高い順に表示しなければならない

### [AC-006] 週次レポートへの統合

**ユーザーストーリー**: システム管理者として、週次レポートでもディスク使用量の予測を確認したい。

#### 受入基準

1. WHEN 週次レポートが生成される場合、THEN Komonはディスク使用量の予測結果をレポートに含めなければならない
2. WHEN 予測結果が警告を含む場合、THEN Komonは週次レポートで目立つ形式で表示しなければならない
3. WHEN 予測結果が「安全」の場合、THEN Komonは簡潔な形式で週次レポートに含めなければならない
4. WHEN 週次レポートの予測セクションは、THEN 他のセクションと視覚的に区別できる形式でなければならない
5. WHEN 予測データが不足している場合、THEN Komonは週次レポートにデータ収集中のメッセージを含めなければならない

### [AC-007] テストによる品質保証

**ユーザーストーリー**: 開発者として、予測ロジックが正確に動作することを確認したい。

#### 受入基準

1. WHEN 予測モジュールが実装される場合、THEN 線形回帰計算の正確性を検証するテストが存在しなければならない
2. WHEN 予測モジュールが実装される場合、THEN 90%到達予測日の計算を検証するテストが存在しなければならない
3. WHEN 予測モジュールが実装される場合、THEN 急激な変化検出の正確性を検証するテストが存在しなければならない
4. WHEN 予測モジュールが実装される場合、THEN エッジケース（データ不足、異常値等）を検証するテストが存在しなければならない
5. WHEN 全てのテストが実行される場合、THEN 既存のテストを含めて全てがパスしなければならない
