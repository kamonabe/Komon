# 実装タスクリスト：ディスク使用量の増加トレンド予測

## タスク概要

このタスクリストは、ディスク使用量の増加トレンド予測機能の実装手順を定義します。各タスクは段階的に実装され、テストで検証されます。

---

## タスク

- [x] 1. disk_predictor.pyモジュールの基本構造を作成


  - `src/komon/disk_predictor.py` を新規作成
  - 必要なインポート文を追加
  - 定数定義（HISTORY_DIR等）
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. データ読み込み機能を実装

  - [x] 2.1 `load_disk_history()` 関数を実装


    - `data/usage_history/` からCSVファイルを読み込み
    - 過去N日分のデータをフィルタリング
    - エラーハンドリング（ファイルなし、読み込みエラー）
    - _要件: 1.1, 1.4, 1.5_
  
  - [x] 2.2 `calculate_daily_average()` 関数を実装


    - 時系列データを日付でグループ化
    - 各日の平均値を計算
    - _要件: 1.1_
  
  - [x] 2.3 データ読み込みのプロパティテストを作成


    - **Property 1: 日次平均計算の正確性**
    - **検証要件: 1.1**
  
  - [x] 2.4 データ読み込みのプロパティテストを作成


    - **Property 2: 欠損データの処理**
    - **検証要件: 1.4**
  
  - [x] 2.5 データ読み込みのユニットテストを作成


    - データ不足のケース
    - 不正なデータのケース
    - ファイルが存在しないケース
    - _要件: 1.2, 1.5_


- [ ] 3. 予測ロジックを実装
  - [x] 3.1 `predict_disk_trend()` 関数を実装


    - 最小二乗法で傾きと切片を計算
    - 90%到達予測日を計算
    - トレンド判定（increasing/stable/decreasing）
    - _要件: 2.1, 2.2, 2.3_
  
  - [x] 3.2 線形回帰のプロパティテストを作成


    - **Property 3: 線形回帰の正確性**
    - **検証要件: 2.1**
  
  - [x] 3.3 90%到達予測のプロパティテストを作成


    - **Property 4: 90%到達予測の正確性**
    - **検証要件: 2.2**
  
  - [x] 3.4 予測ロジックのユニットテストを作成


    - 全て同一値のケース
    - 傾きがゼロまたは負のケース
    - 既に90%以上のケース
    - 予測日が100年以上先のケース
    - _要件: 1.3, 2.3, 2.4, 2.5_


- [ ] 4. 急激な変化検出を実装
  - [x] 4.1 `detect_rapid_change()` 関数を実装


    - 前日比を計算
    - 10%以上の増加を検出
    - _要件: 3.1, 3.2, 3.3_
  
  - [x] 4.2 前日比計算のプロパティテストを作成


    - **Property 5: 前日比計算の正確性**
    - **検証要件: 3.1**
  
  - [x] 4.3 急激な変化検出のプロパティテストを作成


    - **Property 6: 急激な変化検出の正確性**
    - **検証要件: 3.2, 3.3**
  
  - [x] 4.4 急激な変化検出のユニットテストを作成


    - 減少傾向のケース
    - 前日データなしのケース

    - _要件: 3.4, 3.5_

- [ ] 5. メッセージ生成を実装
  - [x] 5.1 `format_prediction_message()` 関数を実装


    - 急激な変化 + 90%到達予測のパターン
    - 急激な変化のみのパターン
    - 通常の増加 + 90%到達予測のパターン
    - 安全な状態のパターン
    - 推奨アクションの生成
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_
  
  - [x] 5.2 メッセージ生成のプロパティテストを作成


    - **Property 7: 予測メッセージの完全性**
    - **検証要件: 4.1, 4.2, 4.3, 4.4**
  
  - [x] 5.3 メッセージ生成のプロパティテストを作成


    - **Property 8: 警告の優先度順表示**
    - **検証要件: 5.5**
  
  - [x] 5.4 メッセージ生成のユニットテストを作成


    - 安全な状態のメッセージ
    - 各パターンのメッセージ形式
    - _要件: 4.5_

- [x] 6. Checkpoint - 基本機能のテスト確認




  - 全てのテストがパスすることを確認
  - ユーザーに質問があれば確認

- [ ] 7. advise.pyへの統合
  - [x] 7.1 `advise_disk_prediction()` 関数を追加


    - disk_predictorモジュールをインポート
    - データ読み込み → 予測計算 → メッセージ生成 → 表示
    - エラーハンドリング
    - _要件: 5.1, 5.2, 5.3_
  
  - [x] 7.2 `run_advise()` 関数に統合


    - `advise_disk_prediction()` を呼び出し
    - 適切な位置に配置（ログ傾向分析の後）
    - _要件: 5.1_
  




  - [x] 7.3 advise統合の統合テストを作成
    - 予測結果が表示されることを確認
    - データ不足時のメッセージを確認
    - エラー時の動作を確認


    - _要件: 5.1, 5.2, 5.3_

- [x] 8. weekly_report.pyへの統合
  - [x] 8.1 `collect_weekly_data()` 関数を拡張


    - disk_predictorモジュールをインポート
    - 予測結果を辞書に追加



    - エラーハンドリング


    - _要件: 6.1, 6.5_






  
  - [x] 8.2 `report_formatter.py` に予測セクションを追加


    - `format_disk_prediction()` 関数を実装





    - 警告がある場合の目立つ表示
    - 安全な場合の簡潔な表示


    - _要件: 6.1, 6.2, 6.3, 6.4_
  


  - [x] 8.3 週次レポート統合の統合テストを作成
    - 予測結果がレポートに含まれることを確認
    - データ不足時のメッセージを確認


    - _要件: 6.1, 6.5_

- [ ] 9. Checkpoint - 統合機能のテスト確認
  - 全てのテストがパスすることを確認
  - ユーザーに質問があれば確認

- [ ] 10. ドキュメント更新
  - [ ] 10.1 README.mdを更新
    - ディスク使用量予測機能の説明を追加
    - 使用例を追加
  
  - [ ] 10.2 CHANGELOG.mdを更新
    - v1.16.0の変更内容を記載
    - 新機能の説明
    - 関連する要件番号を記載

- [ ] 11. Final Checkpoint - 全テスト確認
  - 全てのテストがパスすることを確認
  - カバレッジが95%以上であることを確認
  - ユーザーに質問があれば確認

---

## 注意事項

- 各タスクは順番に実装してください
- プロパティテストは最低100回実行するように設定してください
- エラーハンドリングは一貫性を保ってください
- 既存のコードスタイルに従ってください
- コミットメッセージは日本語で記述してください

## 完了条件

- [ ] 全てのタスクが完了している
- [ ] 全てのテストがパスしている（既存テスト含む）
- [ ] カバレッジが95%以上である
- [ ] `komon advise` で予測結果が表示される
- [ ] 週次レポートに予測結果が含まれる
- [ ] ドキュメントが更新されている
