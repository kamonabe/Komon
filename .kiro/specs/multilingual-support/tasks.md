---
title: Multilingual Support for Komon Notifications - Implementation Tasks
feature: multilingual-support
status: draft
created: 2025-12-19
updated: 2025-12-19
---

# 多言語化対応 - 実装タスク

## 実装順序

実装は段階的に行い、各段階で動作確認とテストを実施する。

## Phase 1: 基盤システム実装

### Task 1.1: MessageManager クラス実装
**要件**: AC-004（メッセージテンプレートシステム）  
**見積もり**: 4時間

**実装内容**:
- [ ] `src/komon/messages.py` ファイル作成
- [ ] MessageManager クラス実装
  - [ ] `__init__` メソッド（言語設定）
  - [ ] `get` メソッド（メッセージ取得）
  - [ ] `_load_messages` メソッド（言語ファイル読み込み）
- [ ] グローバル関数実装
  - [ ] `get_message_manager` 関数（シングルトン）
  - [ ] `get_message` 関数（便利関数）
- [ ] エラーハンドリング実装
  - [ ] 言語ファイル読み込み失敗時の処理
  - [ ] メッセージキー不存在時の処理
  - [ ] 変数埋め込み失敗時の処理

**完了条件**:
- MessageManager クラスが正常に動作する
- フォールバック機能が動作する
- エラー時も適切に処理される

### Task 1.2: 言語ファイル構造設計
**要件**: AC-002（日本語メッセージ）, AC-004（テンプレートシステム）  
**見積もり**: 2時間

**実装内容**:
- [ ] `src/komon/i18n/` ディレクトリ作成
- [ ] `src/komon/i18n/__init__.py` 作成
- [ ] メッセージキー命名規則の策定
  - [ ] カテゴリ別の命名規則（cpu_, memory_, disk_等）
  - [ ] レベル別の命名規則（warning, alert, critical）
- [ ] 変数埋め込み仕様の策定
  - [ ] 変数名の命名規則
  - [ ] フォーマット仕様（{usage}%等）

**完了条件**:
- 言語ファイルの構造が決定している
- メッセージキーの命名規則が明確
- 変数埋め込み仕様が決定している

### Task 1.3: 設定ファイル拡張
**要件**: AC-001（言語設定機能）  
**見積もり**: 3時間

**実装内容**:
- [ ] `settings_validator.py` に言語設定機能を追加
  - [ ] `get_language_setting` 関数実装
  - [ ] `validate_language_setting` 関数実装
- [ ] 環境変数対応
  - [ ] `KOMON_LANGUAGE` 環境変数の読み込み
  - [ ] 設定ファイルより環境変数を優先
- [ ] デフォルト値設定
  - [ ] 未設定時は日本語（ja）
  - [ ] 不正な値の場合は日本語にフォールバック
- [ ] `config/settings.yml.sample` の更新
  - [ ] `general.language` 設定例を追加
  - [ ] コメントで使用可能な言語を説明

**完了条件**:
- 設定ファイルから言語設定を読み込める
- 環境変数での言語指定が動作する
- 不正な設定値でも適切にフォールバックする

## Phase 2: 日本語メッセージ抽出・整理

### Task 2.1: 既存メッセージの調査・抽出
**要件**: AC-002（日本語メッセージ）  
**見積もり**: 6時間

**実装内容**:
- [ ] 全ソースコードから日本語メッセージを抽出
  - [ ] `notification.py` の通知メッセージ
  - [ ] `analyzer.py` の分析結果メッセージ
  - [ ] `contextual_advisor.py` のアドバイスメッセージ
  - [ ] `scripts/advise.py` の出力メッセージ
  - [ ] `scripts/weekly_report.py` のレポートメッセージ
  - [ ] その他のスクリプトの出力メッセージ
- [ ] メッセージの分類・整理
  - [ ] CPU関連メッセージ
  - [ ] メモリ関連メッセージ
  - [ ] ディスク関連メッセージ
  - [ ] プロセス関連メッセージ
  - [ ] ネットワーク関連メッセージ
  - [ ] システム状態メッセージ
  - [ ] レポート関連メッセージ
- [ ] 変数部分の特定
  - [ ] 使用率（{usage}%）
  - [ ] プロセス名（{process_name}）
  - [ ] 日付（{date}）
  - [ ] その他の動的な値

**完了条件**:
- 全ての日本語メッセージが特定されている
- メッセージがカテゴリ別に整理されている
- 変数部分が適切に特定されている

### Task 2.2: 日本語メッセージファイル作成
**要件**: AC-002（日本語メッセージ）  
**見積もり**: 4時間

**実装内容**:
- [ ] `src/komon/i18n/ja.py` ファイル作成
- [ ] 抽出したメッセージをメッセージキーに変換
  - [ ] CPU関連メッセージの定義
  - [ ] メモリ関連メッセージの定義
  - [ ] ディスク関連メッセージの定義
  - [ ] プロセス関連メッセージの定義
  - [ ] ネットワーク関連メッセージの定義
  - [ ] システム状態メッセージの定義
  - [ ] レポート関連メッセージの定義
- [ ] 変数埋め込み形式への変換
  - [ ] `f"CPU使用率: {usage}%"` → `"CPU使用率: {usage}%"`
  - [ ] その他の動的な値の変換
- [ ] メッセージの品質確認
  - [ ] 「やさしい口調」の維持
  - [ ] 絵文字の適切な使用
  - [ ] 一貫性のある表現

**完了条件**:
- 日本語メッセージファイルが完成している
- 全ての既存メッセージが含まれている
- 変数埋め込みが正しく設定されている

## Phase 3: 英語メッセージ作成

### Task 3.1: 英語メッセージの翻訳
**要件**: AC-003（英語メッセージ）  
**見積もり**: 8時間

**実装内容**:
- [ ] `src/komon/i18n/en.py` ファイル作成
- [ ] 日本語メッセージの英語翻訳
  - [ ] CPU関連メッセージの翻訳
  - [ ] メモリ関連メッセージの翻訳
  - [ ] ディスク関連メッセージの翻訳
  - [ ] プロセス関連メッセージの翻訳
  - [ ] ネットワーク関連メッセージの翻訳
  - [ ] システム状態メッセージの翻訳
  - [ ] レポート関連メッセージの翻訳
- [ ] 「やさしい口調」の英語表現
  - [ ] 技術的すぎない表現
  - [ ] 親しみやすい表現
  - [ ] 適切な敬語レベル
- [ ] 変数埋め込みの確認
  - [ ] 全ての変数が正しく埋め込まれる
  - [ ] 英語の語順に適応した文章構造

**完了条件**:
- 英語メッセージファイルが完成している
- 日本語の「やさしい口調」に相当する英語表現
- 全ての変数埋め込みが正常に動作する

### Task 3.2: 翻訳品質の確認・調整
**要件**: AC-003（英語メッセージ）  
**見積もり**: 4時間

**実装内容**:
- [ ] ネイティブスピーカーによるレビュー（可能なら）
- [ ] 技術用語の統一
  - [ ] CPU, Memory, Disk等の表記統一
  - [ ] 単位（%等）の表記統一
- [ ] 文体の統一
  - [ ] 敬語レベルの統一
  - [ ] 親しみやすさのレベル統一
- [ ] 文化的適応
  - [ ] 英語圏での自然な表現
  - [ ] 絵文字の使用方針
- [ ] 長さの調整
  - [ ] 通知メッセージとして適切な長さ
  - [ ] Slack等での表示を考慮

**完了条件**:
- 英語メッセージの品質が確保されている
- 技術用語が統一されている
- 自然な英語表現になっている

## Phase 4: 既存機能の統合

### Task 4.1: 通知機能の多言語化
**要件**: AC-002, AC-003, AC-006（既存機能への影響なし）  
**見積もり**: 6時間

**実装内容**:
- [ ] `notification.py` の修正
  - [ ] `send_slack_alert` 関数の修正
  - [ ] `send_discord_alert` 関数の修正
  - [ ] `send_teams_alert` 関数の修正
  - [ ] `send_email_alert` 関数の修正
- [ ] ハードコードされたメッセージの置き換え
  - [ ] 直接的な日本語文字列を `get_message` 呼び出しに変更
  - [ ] 変数埋め込みの適切な実装
- [ ] 通知履歴機能の対応
  - [ ] `notification_history.py` の修正
  - [ ] 履歴保存時の言語情報保持（将来拡張用）

**完了条件**:
- 全ての通知機能が多言語対応されている
- 既存の通知機能が正常に動作する
- 通知履歴機能も正常に動作する

### Task 4.2: 分析機能の多言語化
**要件**: AC-002, AC-003, AC-006  
**見積もり**: 5時間

**実装内容**:
- [ ] `analyzer.py` の修正
  - [ ] CPU分析結果メッセージの多言語化
  - [ ] メモリ分析結果メッセージの多言語化
  - [ ] ディスク分析結果メッセージの多言語化
- [ ] `contextual_advisor.py` の修正
  - [ ] プロセス別アドバイスメッセージの多言語化
  - [ ] 詳細度別メッセージの多言語化
- [ ] `log_analyzer.py` の修正
  - [ ] ログ分析結果メッセージの多言語化
- [ ] `disk_predictor.py` の修正（該当する場合）
  - [ ] 予測結果メッセージの多言語化

**完了条件**:
- 全ての分析機能が多言語対応されている
- 分析結果が適切な言語で表示される
- 既存の分析精度が維持されている

### Task 4.3: CLI出力の多言語化
**要件**: AC-002, AC-003, AC-006  
**見積もり**: 6時間

**実装内容**:
- [ ] `scripts/advise.py` の修正
  - [ ] システム状態表示の多言語化
  - [ ] 改善提案メッセージの多言語化
  - [ ] プロセス情報表示の多言語化
- [ ] `scripts/status.py` の修正
  - [ ] ステータス表示の多言語化
- [ ] `scripts/weekly_report.py` の修正
  - [ ] 週次レポートの多言語化
  - [ ] トレンド分析結果の多言語化
- [ ] その他のスクリプトの修正
  - [ ] `scripts/main_log_trend.py`
  - [ ] `scripts/main_log_monitor.py`

**完了条件**:
- 全てのCLI出力が多言語対応されている
- ユーザーインターフェースが一貫している
- 既存の機能が全て正常に動作する

## Phase 5: テスト実装

### Task 5.1: ユニットテスト作成
**要件**: AC-004, AC-005, AC-006  
**見積もり**: 8時間

**実装内容**:
- [ ] `tests/test_messages.py` 作成
  - [ ] MessageManager クラスのテスト
  - [ ] メッセージ取得機能のテスト
  - [ ] フォールバック機能のテスト
  - [ ] 変数埋め込み機能のテスト
- [ ] `tests/test_i18n_consistency.py` 作成
  - [ ] 言語ファイル間の整合性テスト
  - [ ] メッセージキーの一致確認
  - [ ] 変数埋め込み形式の確認
- [ ] `tests/test_settings_language.py` 作成
  - [ ] 言語設定読み込みのテスト
  - [ ] 環境変数対応のテスト
  - [ ] 不正値処理のテスト

**完了条件**:
- 全ての新機能にユニットテストが存在する
- テストカバレッジが90%以上
- 全てのテストが通過する

### Task 5.2: 統合テスト作成
**要件**: AC-001, AC-006  
**見積もり**: 6時間

**実装内容**:
- [ ] `tests/test_multilingual_integration.py` 作成
  - [ ] 通知機能の多言語統合テスト
  - [ ] 分析機能の多言語統合テスト
  - [ ] CLI出力の多言語統合テスト
- [ ] 既存テストの多言語対応確認
  - [ ] 既存のテストが多言語化後も通過することを確認
  - [ ] 必要に応じて既存テストを修正
- [ ] エンドツーエンドテスト
  - [ ] 設定ファイルでの言語切り替えテスト
  - [ ] 環境変数での言語切り替えテスト

**完了条件**:
- 統合テストが全て通過する
- 既存のテストが全て通過する
- エンドツーエンドでの動作が確認できる

### Task 5.3: プロパティベーステスト作成
**要件**: AC-004, AC-005  
**見積もり**: 4時間

**実装内容**:
- [ ] `tests/test_messages_properties.py` 作成
  - [ ] ランダムな変数値での埋め込みテスト
  - [ ] 存在しないキーでのフォールバックテスト
  - [ ] 不正な言語コードでの動作テスト
- [ ] Hypothesis を使用したプロパティテスト
  - [ ] メッセージキーの生成と検証
  - [ ] 変数値の生成と埋め込み検証
  - [ ] エラー条件の生成と処理検証

**完了条件**:
- プロパティベーステストが実装されている
- ランダムな入力に対して適切に動作する
- エッジケースが適切に処理される

## Phase 6: ドキュメント・リリース準備

### Task 6.1: ドキュメント更新
**要件**: AC-001, AC-002, AC-003  
**見積もり**: 4時間

**実装内容**:
- [ ] `README.md` の更新
  - [ ] 多言語対応機能の説明追加
  - [ ] 設定例の追加
  - [ ] 使用方法の説明
- [ ] `config/settings.yml.sample` の更新
  - [ ] 言語設定の例を追加
  - [ ] コメントで説明を追加
- [ ] `docs/EXAMPLES.md` の更新（該当する場合）
  - [ ] 多言語設定の例を追加
- [ ] 翻訳貢献ガイドの作成
  - [ ] 新しい言語の追加方法
  - [ ] 翻訳品質のガイドライン

**完了条件**:
- ドキュメントが最新の機能を反映している
- ユーザーが多言語機能を理解できる
- 翻訳貢献の方法が明確

### Task 6.2: リリース準備
**要件**: AC-006  
**見積もり**: 3時間

**実装内容**:
- [ ] `CHANGELOG.md` の更新
  - [ ] 多言語対応機能の追加を記録
  - [ ] 破壊的変更がないことを明記
  - [ ] 新機能の使用方法を説明
- [ ] バージョン番号の決定
  - [ ] セマンティックバージョニングに従う
  - [ ] 新機能追加なのでMINORバージョンアップ
- [ ] リリースノートの作成
  - [ ] 新機能の概要
  - [ ] 設定方法の説明
  - [ ] 既存ユーザーへの影響（なし）

**完了条件**:
- リリース準備が完了している
- 変更履歴が適切に記録されている
- リリースノートが作成されている

### Task 6.3: 最終検証
**要件**: 全ての受入基準  
**見積もり**: 4時間

**実装内容**:
- [ ] 全受入基準の最終確認
  - [ ] AC-001: 言語設定機能の動作確認
  - [ ] AC-002: 日本語メッセージの完全対応確認
  - [ ] AC-003: 英語メッセージの提供確認
  - [ ] AC-004: メッセージテンプレートシステム確認
  - [ ] AC-005: フォールバック機能確認
  - [ ] AC-006: 既存機能への影響なし確認
- [ ] パフォーマンステスト
  - [ ] メッセージ取得のレスポンス時間測定
  - [ ] メモリ使用量の測定
  - [ ] 起動時間への影響測定
- [ ] 実環境での動作確認
  - [ ] 各言語での通知動作確認
  - [ ] 設定ファイルでの言語切り替え確認
  - [ ] 環境変数での言語切り替え確認

**完了条件**:
- 全ての受入基準が満たされている
- パフォーマンス要件が満たされている
- 実環境での動作が確認されている

## 実装時の注意事項

### 品質保証
- 各Phaseの完了時に動作確認を実施
- テストカバレッジ90%以上を維持
- 既存機能への影響がないことを確認

### パフォーマンス
- メッセージ取得のオーバーヘッドを最小限に
- メモリ使用量の増加を1MB以下に抑制
- 起動時間への影響を50ms以下に抑制

### 後方互換性
- 既存の設定ファイルがそのまま動作すること
- 既存のテストが全て通過すること
- 既存ユーザーの操作に変更がないこと

### エラーハンドリング
- 言語ファイル読み込み失敗時の適切な処理
- 不正な設定値に対する適切なフォールバック
- エラー時も機能が停止しないこと

## 完了基準

### 機能完了基準
- [ ] 全ての受入基準（AC-001〜AC-006）が満たされている
- [ ] 日本語・英語の両方で全機能が正常に動作する
- [ ] 設定ファイルと環境変数での言語切り替えが動作する
- [ ] フォールバック機能が適切に動作する

### 品質完了基準
- [ ] テストカバレッジが90%以上
- [ ] 全てのテスト（ユニット・統合・プロパティ）が通過
- [ ] パフォーマンス要件が満たされている
- [ ] 既存機能への影響がない

### ドキュメント完了基準
- [ ] README.md が更新されている
- [ ] 設定例が提供されている
- [ ] 翻訳貢献ガイドが作成されている
- [ ] CHANGELOG.md が更新されている

### リリース完了基準
- [ ] 実環境での動作確認が完了している
- [ ] リリースノートが作成されている
- [ ] バージョン番号が決定されている
- [ ] 全ての関係者による最終確認が完了している