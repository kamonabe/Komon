---
feature: Progressive Threshold Notification
status: draft
created: 2025-11-23
updated: 2025-11-23
---

# 要件定義: 段階的閾値通知

## 概要
3段階の閾値通知システム（警告/警戒/緊急）を実装し、リソース問題の早期検知を可能にする。既存の単一閾値設定との後方互換性を維持する。

## 受入基準

### [AC-001] 3段階閾値設定のサポート
**WHEN** システムがsettings.ymlを読み込むとき  
**THEN** 各メトリクスタイプ（CPU/メモリ/ディスク）に対して3段階の閾値設定（警告/警戒/緊急）をサポートすること

### [AC-002] 後方互換性の維持
**WHEN** settings.ymlに従来の単一閾値設定が含まれているとき  
**THEN** システムは既存の設定を変更せずに動作し続けること

### [AC-003] 3段階判定ロジック
**WHEN** メトリクス値がいずれかの閾値レベルを超えたとき  
**THEN** システムは適切なレベル（警告/警戒/緊急）を判定し、対応するメッセージを生成すること

### [AC-004] レベル別メッセージテンプレート
**WHEN** 通知メッセージを生成するとき  
**THEN** システムはレベルに応じたメッセージテンプレートと対応する絵文字（💛 警告 / 🧡 警戒 / ❤️ 緊急）を使用すること

### [AC-005] エスカレーション検知
**WHEN** 閾値レベルが上昇したとき（例: 70% → 80% → 90%）  
**THEN** システムはエスカレーションを検知し、通知頻度制御の設定に関わらず即座に通知すること

### [AC-006] 設定の検証
**WHEN** 3段階閾値設定を読み込むとき  
**THEN** システムは各メトリクスタイプについて 警告 < 警戒 < 緊急 の順序を検証すること

## 非機能要件

### [NFR-001] パフォーマンス
閾値判定ロジックは、チェックサイクルあたりの処理時間を10ms以上増加させないこと。

### [NFR-002] 保守性
実装は、閾値設定、判定ロジック、メッセージ生成の間で明確な分離を維持すること。

### [NFR-003] テスト容易性
すべての閾値レベルとメッセージテンプレートは、ユニットテストとプロパティベーステストでテスト可能であること。

## スコープ外
- 履歴データに基づく自動閾値調整
- ユーザー定義のカスタム閾値レベル（3段階に固定）
- プロセス別の閾値設定
