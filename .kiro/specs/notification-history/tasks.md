---
title: 通知履歴機能 - 実装タスク
feature: notification-history
status: completed
created: 2025-11-22
updated: 2025-11-22
---

# 通知履歴機能 - 実装タスク

## タスクチェックリスト

- [x] 1. コア機能を持つ通知履歴モジュールの作成
  - 保存・読み込み関数を持つ`src/komon/notification_history.py`を作成
  - 適切なエラーハンドリングを持つJSON ファイルI/Oの実装
  - 100件ローテーションロジックの実装
  - _要件: AC-001.1, AC-001.2, AC-001.3, AC-001.4, AC-003.1, AC-003.2_

- [x] 1.1 通知の永続化のプロパティテストを作成
  - **プロパティ1: 通知の永続化**
  - **検証対象: 要件 AC-001.1, AC-001.2**

- [x] 1.2 最大キューサイズの不変条件のプロパティテストを作成
  - **プロパティ2: 最大キューサイズの不変条件**
  - **検証対象: 要件 AC-001.4, AC-003.1**

- [x] 1.3 時系列順序の保持のプロパティテストを作成
  - **プロパティ3: 時系列順序の保持**
  - **検証対象: 要件 AC-003.2**

- [x] 2. 通知のフォーマットと表示の実装
  - 人間が読みやすい出力のための`format_notification()`関数を作成
  - タイムスタンプのフォーマット実装（ISO 8601から読みやすい形式へ）
  - 絵文字と明確な構造を持つ出力形式の設計
  - _要件: AC-002.3_

- [x] 2.1 フォーマットの完全性のプロパティテストを作成
  - **プロパティ5: フォーマットの完全性**
  - **検証対象: 要件 AC-002.3**

- [x] 3. 既存の通知システムへの履歴保存の統合
  - `src/komon/notification.py`の`send_slack_alert()`をメタデータを受け取るように変更
  - try-except保護付きで履歴保存呼び出しを追加
  - `send_email_alert()`も同様に変更
  - `scripts/main.py`の呼び出し箇所をメタデータを渡すように更新
  - _要件: AC-001.1, AC-004.1, AC-004.2_

- [x] 3.1 通知統合のユニットテストを作成
  - 履歴保存が失敗してもSlack通知が動作することをテスト
  - メタデータが正しく渡され保存されることをテスト
  - 既存コードとの後方互換性をテスト
  - _要件: AC-004.1, AC-004.2_

- [x] 4. 履歴表示機能で助言コマンドを拡張
  - `scripts/advise.py`に`advise_notification_history()`関数を追加
  - `--history N`コマンドライン引数の解析を実装
  - メイン助言出力に履歴表示セクションを追加
  - ファイル不在と破損ファイルのケースを適切に処理
  - _要件: AC-002.1, AC-002.2, AC-002.4, AC-002.5, AC-004.3_

- [x] 4.1 制限付き履歴取得のプロパティテストを作成
  - **プロパティ4: 制限付き履歴取得**
  - **検証対象: 要件 AC-002.2**

- [x] 4.2 グレースフルなエラーハンドリングのプロパティテストを作成
  - **プロパティ6: グレースフルなエラーハンドリング**
  - **検証対象: 要件 AC-002.5, AC-003.3**

- [x] 4.3 助言コマンド拡張のユニットテストを作成
  - 履歴なしでの表示をテスト
  - 破損ファイルでの表示をテスト
  - --history Nオプションをテスト
  - _要件: AC-002.1, AC-002.4, AC-002.5_

- [x] 5. チェックポイント - 全テストがパスすることを確認
  - 全テストがパスすることを確認し、疑問があればユーザーに質問する

- [x] 6. ドキュメントの更新
  - README.mdに使用例を追加
  - 新しい--historyオプションをドキュメント化
  - CHANGELOG.mdに新機能を記録
  - _要件: 全て_
