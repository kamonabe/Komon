metadata:
  title: 通知履歴機能 - 実装タスク
  feature: notification-history
  status: completed
  created: 2025-11-22
  updated: 2025-11-22
  version: "1.0.0"  # Specのバージョン
  last_validated: null  # YYYY-MM-DD or null
  validation_passed: null  # true | false | null
tasks:
- id: T1
  title: "コア機能を持つ通知履歴モジュールの作成\n  - 保存・読み込み関数を持つ`src/komon/notification_history.py`を作成\n\
    \  - 適切なエラーハンドリングを持つJSON ファイルI/Oの実装\n  - 100件ローテーションロジックの実装"
  status: done
  priority: high
  estimated-hours: 2
  depends-on: []
  validates:
  - AC-001.1
  - AC-001.2
  - AC-001.3
  - AC-001.4
  - AC-003.1
  - "AC-003.2_\n\n- [x] 1.1 通知の永続化のプロパティテストを作成\n  - **プロパティ1: 通知の永続化**\n  - **検証対象:\
    \ 要件 AC-001.1"
  - "AC-001.2**\n\n- [x] 1.2 最大キューサイズの不変条件のプロパティテストを作成\n  - **プロパティ2: 最大キューサイズの不変条件**\n\
    \  - **検証対象: 要件 AC-001.4"
  - "AC-003.1**\n\n- [x] 1.3 時系列順序の保持のプロパティテストを作成\n  - **プロパティ3: 時系列順序の保持**\n  - **検証対象:\
    \ 要件 AC-003.2**\n\n- [x] 2. 通知のフォーマットと表示の実装\n  - 人間が読みやすい出力のための`format_notification()`関数を作成\n\
    \  - タイムスタンプのフォーマット実装（ISO 8601から読みやすい形式へ）\n  - 絵文字と明確な構造を持つ出力形式の設計\n  - _要件: AC-002.3_\n\
    \n- [x] 2.1 フォーマットの完全性のプロパティテストを作成\n  - **プロパティ5: フォーマットの完全性**\n  - **検証対象: 要件\
    \ AC-002.3**\n\n- [x] 3. 既存の通知システムへの履歴保存の統合\n  - `src/komon/notification.py`の`send_slack_alert()`をメタデータを受け取るように変更\n\
    \  - try-except保護付きで履歴保存呼び出しを追加\n  - `send_email_alert()`も同様に変更\n  - `scripts/main.py`の呼び出し箇所をメタデータを渡すように更新\n\
    \  - _要件: AC-001.1"
  - AC-004.1
  - "AC-004.2_\n\n- [x] 3.1 通知統合のユニットテストを作成\n  - 履歴保存が失敗してもSlack通知が動作することをテスト\n  -\
    \ メタデータが正しく渡され保存されることをテスト\n  - 既存コードとの後方互換性をテスト\n  - _要件: AC-004.1"
  - "AC-004.2_\n\n- [x] 4. 履歴表示機能で助言コマンドを拡張\n  - `scripts/advise.py`に`advise_notification_history()`関数を追加\n\
    \  - `--history N`コマンドライン引数の解析を実装\n  - メイン助言出力に履歴表示セクションを追加\n  - ファイル不在と破損ファイルのケースを適切に処理\n\
    \  - _要件: AC-002.1"
  - AC-002.2
  - AC-002.4
  - AC-002.5
  - "AC-004.3_\n\n- [x] 4.1 制限付き履歴取得のプロパティテストを作成\n  - **プロパティ4: 制限付き履歴取得**\n  - **検証対象:\
    \ 要件 AC-002.2**\n\n- [x] 4.2 グレースフルなエラーハンドリングのプロパティテストを作成\n  - **プロパティ6: グレースフルなエラーハンドリング**\n\
    \  - **検証対象: 要件 AC-002.5"
  - "AC-003.3**\n\n- [x] 4.3 助言コマンド拡張のユニットテストを作成\n  - 履歴なしでの表示をテスト\n  - 破損ファイルでの表示をテスト\n\
    \  - --history Nオプションをテスト\n  - _要件: AC-002.1"
  - AC-002.4
  - "AC-002.5_\n\n- [x] 5. チェックポイント - 全テストがパスすることを確認\n  - 全テストがパスすることを確認し、疑問があればユーザーに質問する\n\
    \n- [x] 6. ドキュメントの更新\n  - README.mdに使用例を追加\n  - 新しい--historyオプションをドキュメント化\n  -\
    \ CHANGELOG.mdに新機能を記録\n  - _要件: 全て"
