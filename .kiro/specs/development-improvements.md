---
title: Komon - 開発基盤の改善案
status: ideas
version: draft
created: 2025-11-30
---

# Komon 開発基盤の改善案

このドキュメントは、**機能追加ではなく開発基盤・品質向上**のための改善案を記録します。

## 📖 このファイルと future-ideas.md の使い分け

### このファイル（development-improvements.md）
**対象**: **開発者向け基盤**の改善

**記録する内容**:
- ✅ 開発体制・プロセスの改善
- ✅ コード品質向上（型ヒント、リファクタリング等）
- ✅ セキュリティ強化
- ✅ テスト戦略の改善
- ✅ CI/CD・ビルドシステムの改善
- ✅ ドキュメント整備（開発者向け）
- ✅ 環境対応・拡張性（OS抽象化等）
- ✅ ステアリングルールの強化

**特徴**:
- ユーザーには直接見えない（間接的に恩恵）
- 開発者が体験する改善
- 「Komonをどう作るか」を改善

**例**:
- 型ヒント（mypy）の導入
- 脆弱性スキャンの自動化
- マルチLinuxディストリビューション対応
- AI開発ルールの明文化

---

### future-ideas.md
**対象**: **ユーザー向け機能**の追加・改善

**記録する内容**:
- ✅ 新機能の追加
- ✅ 既存機能の改善
- ✅ 通知メッセージの改善
- ✅ 検出機能の追加
- ✅ レポート機能の追加
- ✅ ユーザビリティの向上

**特徴**:
- ユーザーが直接体験する機能
- Komonの「やさしく見守る」価値を高める
- 「Komonで何ができるか」を増やす

**例**:
- 段階的通知メッセージ
- コンテキスト型アドバイス
- ディスク使用量予測
- 長時間実行プロセス検出
- State Snapshot & Diff Detection

---

### 判断に迷ったら

**質問1**: ユーザーが直接体験する機能か？
- YES → `future-ideas.md`
- NO → 次の質問へ

**質問2**: 開発者・保守者が体験する改善か？
- YES → `development-improvements.md`
- NO → どちらにも該当しない（記録不要かも）

**例**:
- 「週次レポート機能」→ ユーザーが体験 → `future-ideas.md`
- 「型ヒント追加」→ 開発者が体験 → `development-improvements.md`
- 「マルチOS対応」→ 開発基盤の拡張 → `development-improvements.md`
- 「英語版ドキュメント」→ ユーザー向けドキュメント → `development-improvements.md`

---

---

## 📊 プロジェクト評価（2025-11-30時点）

### 総合スコア: **85/100** (優秀)

#### 評価内訳

| 評価項目 | スコア | 評価 | 主な強み |
|---------|--------|------|---------|
| 1. 機能面 | 90/100 | 優秀 | 3段階閾値、段階的通知、ディスク予測、コンテキスト型アドバイス |
| 2. 開発体制 | 95/100 | 非常に優秀 | 仕様駆動開発、AI支援開発、タスク管理、品質保証 |
| 3. 開発ルール | 90/100 | 優秀 | 8種類のステアリングルール、検証スクリプト |
| 4. コード品質 | 88/100 | 優秀 | カバレッジ92.7%、339テスト、プロパティテスト |
| 5. ユーザビリティ | 85/100 | 良好 | 導入10分、やさしい日本語、詳細ドキュメント |
| 6. プロジェクト管理 | 92/100 | 優秀 | Semantic Versioning、CHANGELOG、CI/CD |
| 7. セキュリティ | 88/100 | 優秀 | 環境変数管理、AI機密情報検知 |
| 8. 保守性・拡張性 | 87/100 | 優秀 | シンプルな構造、18モジュール約2,872行 |

### 特筆すべき点

**1. 仕様駆動開発の徹底**
- Spec文書 → 実装 → テストの流れが確立
- AI支援開発（Kiro IDE）との統合
- 検証スクリプトで品質保証

**2. テスト品質の高さ**
- カバレッジ92.7%（339テスト）
- プロパティテスト + 統合テスト + ユニットテスト
- hypothesis使用で不変条件を検証

**3. 実用性の高さ**
- 軽量（メモリ約30MB）
- 既存監視ツールと併用可能
- 段階的通知で「通知疲れ」を防止

**4. ドキュメントの充実**
- README.md約500行
- 各機能のSpec文書
- セキュリティガイド完備

---

## 🎯 改善提案（軽量性との共存を重視）

### ✅ 即座に実施すべき改善（軽量性に影響なし）

#### [IMPROVE-001] 型ヒントの追加（mypy導入）

**カテゴリ**: コード品質  
**提案日**: 2025-11-30  
**ステータス**: 提案  
**優先度**: 高

##### 背景
- 現在、型ヒントが不足している
- バグの早期発見が難しい
- IDEの補完が不十分

##### 改善内容
```bash
# 開発用パッケージに追加
echo "mypy>=1.0.0" >> requirements-dev.txt
pip install mypy

# 設定ファイル作成
cat > mypy.ini << 'EOF'
[mypy]
python_version = 3.10
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False  # 段階的に導入
ignore_missing_imports = True
EOF

# 段階的に型ヒントを追加
# まずは新規コードから、既存コードは徐々に
```

##### 影響評価
- **実行時オーバーヘッド**: ゼロ（静的解析のみ）
- **メモリ使用量**: 変化なし
- **依存パッケージ**: 開発時のみ（requirements-dev.txt）
- **軽量性**: 影響なし ✅

##### 期待効果
- バグの早期発見
- IDEの補完が向上
- リファクタリングが安全に
- メンテナンスコストの削減

##### 実装ステップ
1. `mypy.ini`の作成
2. `requirements-dev.txt`への追加
3. CI/CDにmypyチェック追加
4. 新規コード（v1.22.0以降）に型ヒント追加
5. 既存コードに段階的に型ヒント追加
   - まずはコアモジュール（monitor.py, analyzer.py）
   - 次に通知系（notification.py, notification_history.py）
   - 最後にその他

##### 評価への影響
- **コード品質**: 88/100 → **92/100** (+4点)
  - 型安全性: 75/100 → **90/100** (+15点)

---

#### [IMPROVE-002] 脆弱性スキャンの自動化

**カテゴリ**: セキュリティ  
**提案日**: 2025-11-30  
**ステータス**: 提案  
**優先度**: 高

##### 背景
- 現在、手動での脆弱性チェックのみ
- 依存パッケージの脆弱性を見逃す可能性
- セキュリティリスクの早期発見が困難

##### 改善内容
```bash
# 開発用パッケージに追加
echo "safety>=2.0.0" >> requirements-dev.txt
echo "pip-audit>=2.0.0" >> requirements-dev.txt

# GitHub Actionsに追加
# .github/workflows/security.yml
```

```yaml
name: Security Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 0 * * 0'  # 毎週日曜日

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install safety pip-audit
          pip install -r requirements.txt
      - name: Run safety check
        run: safety check
      - name: Run pip-audit
        run: pip-audit
```

##### 影響評価
- **実行時オーバーヘッド**: ゼロ（CI/CDで実行）
- **メモリ使用量**: 変化なし
- **本番環境**: 影響なし
- **軽量性**: 影響なし ✅

##### 期待効果
- セキュリティリスクの早期発見
- 依存パッケージの安全性確保
- 自動化で手間なし

##### 実装ステップ
1. `requirements-dev.txt`への追加
2. `.github/workflows/security.yml`作成
3. 初回スキャン実行
4. 問題があれば修正

##### 評価への影響
- **セキュリティ**: 88/100 → **92/100** (+4点)
  - 脆弱性対策: 80/100 → **95/100** (+15点)

---

### ⏸️ 将来的に検討（今は不要）

#### [IMPROVE-003] 英語版ドキュメント

**カテゴリ**: ドキュメント  
**提案日**: 2025-11-30  
**ステータス**: 将来検討  
**優先度**: 低

##### 背景
- 現在は日本語のみ
- 国際的なユーザー獲得の可能性
- ただし、更新頻度が高い

##### 見送る理由
- ✅ 現在は頻繁に更新中（v1.21.0まで継続的にリリース）
- ✅ 英語版のメンテナンスコストが高い
- ✅ 日本語版の品質を優先すべき
- ✅ README冒頭の英語サマリーで十分

##### 将来的に検討するタイミング
- 機能が安定してきた（v2.0.0以降？）
- 更新頻度が落ち着いた
- 海外からの問い合わせが増えた

##### 影響評価
- **軽量性**: 影響なし ✅（ドキュメントのみ）

---

#### [IMPROVE-003] セキュリティ強化

**カテゴリ**: セキュリティ  
**提案日**: 2025-11-30  
**ステータス**: 提案  
**優先度**: 高

##### 背景
- 現在のセキュリティ評価: 88/100
- 脆弱性スキャンが未自動化
- セキュリティポリシーが不明確
- ファイルパーミッションの推奨値が不明確

##### 重要な認識
**「個人開発だからセキュリティは仕方ない」は通用しない**
- ユーザーのデータを扱う以上、責任がある
- チーム開発体制や運用体制は「前提が違う」ので比較対象外
- しかし、セキュリティは言い訳できない

##### 改善内容（優先度順）

**🔴 高優先度（即座に実施すべき）**

**1. 脆弱性スキャンの自動化**（IMPROVE-002と統合）
```yaml
# .github/workflows/security.yml
name: Security Scan
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 0 * * 0'  # 毎週日曜日

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install safety pip-audit
          pip install -r requirements.txt
      - name: Run safety check
        run: safety check
      - name: Run pip-audit
        run: pip-audit
```

**2. SECURITY.mdの拡充**
```markdown
# セキュリティポリシー

## 脆弱性の報告

脆弱性を発見した場合は、以下の方法で報告してください：

1. **GitHub Security Advisory**（推奨）
   - https://github.com/kamonabe/Komon/security/advisories/new
   - 非公開で報告できます

2. **Issue**
   - 軽微な問題はIssueで報告可能
   - 重大な脆弱性はSecurity Advisoryを使用

## 対応方針

- 報告から48時間以内に初回返信
- 重大な脆弱性は7日以内にパッチリリース
- 軽微な脆弱性は次のバージョンで修正

## セキュリティアップデート

- セキュリティ修正は最優先
- CHANGELOG.mdに明記
- GitHub Releasesで通知
```

**3. ファイルパーミッションの推奨値を明記**
```markdown
# README.md または SECURITY.md に追加

## ファイルパーミッション

以下のファイルは適切なパーミッションを設定してください：

```bash
# 設定ファイル（機密情報を含む）
chmod 600 settings.yml

# 通知履歴（個人情報を含む可能性）
chmod 700 data/notifications/
chmod 600 data/notifications/*.json

# ログファイル
chmod 600 log/*.log
```

**推奨パーミッション**:
- 設定ファイル: 600（所有者のみ読み書き）
- データディレクトリ: 700（所有者のみアクセス）
- ログファイル: 600（所有者のみ読み書き）
```

**🟡 中優先度（検討すべき）**

**4. 設定ファイルの検証強化**
```python
# src/komon/settings_validator.py に追加

def validate_file_permissions(file_path):
    """ファイルパーミッションをチェック"""
    import os
    import stat
    
    if not os.path.exists(file_path):
        return
    
    st = os.stat(file_path)
    mode = st.st_mode
    
    # 他者に読み取り権限がある場合は警告
    if mode & stat.S_IROTH:
        logger.warning(
            "⚠️  %s は他者に読み取り可能です。"
            "chmod 600 %s を推奨します。",
            file_path, file_path
        )
```

**5. 依存パッケージのバージョン固定**
```txt
# requirements.txt
psutil==5.9.6  # 現在: >=5.9.0
PyYAML==6.0.1  # 現在: >=6.0
requests==2.31.0  # 現在: >=2.31.0
```

**メリット**:
- 再現性の向上
- 予期しない脆弱性の混入を防ぐ

**デメリット**:
- セキュリティパッチの適用が手動に
- 定期的な更新が必要

**判断**: 要検討（メリット・デメリットのバランス）

**6. 入力値検証の強化**
```python
# src/komon/settings_validator.py

def validate_webhook_url(url):
    """Webhook URLの検証"""
    if not url.startswith('https://'):
        raise ValidationError(
            "Webhook URLはHTTPSである必要があります"
        )
    
    # 内部IPアドレスへのアクセスを防ぐ（SSRF対策）
    import ipaddress
    from urllib.parse import urlparse
    
    parsed = urlparse(url)
    try:
        ip = ipaddress.ip_address(parsed.hostname)
        if ip.is_private:
            raise ValidationError(
                "内部IPアドレスへのWebhookは許可されていません"
            )
    except ValueError:
        pass  # ホスト名の場合はスキップ
```

**🟢 低優先度（将来的に検討）**

**7. セキュリティ監査（第三者）**
- ペネトレーションテスト
- コードレビュー（セキュリティ専門家）
- 脆弱性診断

**現実的には**: 個人開発では難しい  
**代替案**: コミュニティレビュー、バグバウンティ（将来）

##### 影響評価
- **実行時オーバーヘッド**: ゼロ（高優先度項目）
- **メモリ使用量**: 変化なし
- **軽量性**: 影響なし ✅

##### 期待効果
- 依存パッケージの脆弱性を自動検知
- 脆弱性報告の手順が明確に
- ユーザーがセキュリティ設定を適切に行える
- SSRF攻撃の防止
- 不適切なファイルパーミッションの警告

##### 実装ステップ
1. `.github/workflows/security.yml`作成
2. `docs/SECURITY.md`拡充
3. README.mdにファイルパーミッション推奨値を追加
4. 初回スキャン実行、問題があれば修正
5. （中優先度）設定ファイルの検証強化
6. （中優先度）入力値検証の強化

##### 評価への影響

**高優先度のみ実施**:
- **セキュリティ**: 88/100 → **92/100** (+4点)
  - 脆弱性対策: 80/100 → **95/100** (+15点)

**中優先度も実施**:
- **セキュリティ**: 88/100 → **95/100** (+7点)
  - 機密情報管理: 95/100 → **98/100** (+3点)
  - ログ管理: 90/100 → **95/100** (+5点)
  - 依存管理: 85/100 → **95/100** (+10点)
  - 脆弱性対策: 80/100 → **95/100** (+15点)

##### 重要な原則
**「個人開発だから」は言い訳にならない**
- チーム開発体制: 比較対象外（前提が違う）
- 運用体制: 比較対象外（前提が違う）
- 規模: 比較対象外（シンプルを追求）
- **セキュリティ: 言い訳できない**（ユーザーのデータを扱う責任）

---

### ⚠️ 慎重に検討すべき改善

#### [IMPROVE-004] シンプルなプラグイン機構

**カテゴリ**: 拡張性  
**提案日**: 2025-11-30  
**ステータス**: 検討中  
**優先度**: 中

##### 背景
- 現在、通知手段の追加にはコード変更が必要
- 拡張性を高めたい
- ただし、複雑化は避けたい

##### 改善内容
```python
# シンプルなプラグイン機構（+数KB）
class NotificationPlugin:
    def send(self, message: str) -> None:
        raise NotImplementedError

class SlackPlugin(NotificationPlugin):
    def send(self, message: str) -> None:
        # Slack通知
        pass

class DiscordPlugin(NotificationPlugin):
    def send(self, message: str) -> None:
        # Discord通知
        pass
```

##### 影響評価
- **メモリ使用量**: +数KB（無視できる）
- **依存パッケージ**: 変化なし（プラグインは外部）
- **軽量性**: ほぼ影響なし ✅

##### 条件
- シンプルな設計であること
- コア機能はシンプルに保つこと
- プラグインは外部管理

##### 実装ステップ
1. プラグインインターフェースの設計
2. プラグインローダーの実装
3. 既存通知機能のプラグイン化
4. ドキュメント作成

---

### ❌ 実施すべきでない改善（軽量性を損なう）

#### [IMPROVE-005] Web UI

**カテゴリ**: ユーザビリティ  
**提案日**: 2025-11-30  
**ステータス**: 却下  
**優先度**: なし

##### 背景
- GUIがあると便利かもしれない
- ダッシュボードで可視化

##### 却下する理由
- ❌ Webフレームワーク（Flask/FastAPI）が必要
- ❌ メモリ使用量: +50MB以上
- ❌ 依存パッケージ: 大幅増加
- ❌ Komonの「軽量」という根本理念に反する
- ❌ 既存監視ツール（Prometheus等）との差別化が失われる

##### 代替案
- 別プロジェクトとして分離（komon-web）
- コア機能はCLIのまま維持

##### 影響評価
- **軽量性**: 大きく損なう ❌

---

#### [IMPROVE-006] チーム開発フロー

**カテゴリ**: プロジェクト管理  
**提案日**: 2025-11-30  
**ステータス**: 却下  
**優先度**: なし

##### 背景
- 複数人での開発フロー
- 権限管理、ロック機構

##### 却下する理由
- ❌ 権限管理、ロック機構等が必要
- ❌ データベース導入の可能性
- ❌ メモリ使用量: +20MB以上
- ❌ 「個人開発者向け」という位置づけに反する
- ❌ シンプルさが失われる

##### 影響評価
- **軽量性**: 損なう ❌

---

## 📊 改善後の評価予測

### 現在の評価
- **総合**: 85/100
- **コード品質**: 88/100
  - 型安全性: 75/100
- **セキュリティ**: 88/100
  - 脆弱性対策: 80/100

### 改善後の評価（型ヒント + セキュリティ強化）

**高優先度のみ実施（型ヒント + 脆弱性スキャン + SECURITY.md拡充）**:
- **総合**: **88/100** (+3点)
- **コード品質**: **92/100** (+4点)
  - 型安全性: **90/100** (+15点)
- **セキュリティ**: **92/100** (+4点)
  - 脆弱性対策: **95/100** (+15点)

**中優先度も実施（上記 + 検証強化 + 入力値検証）**:
- **総合**: **90/100** (+5点)
- **コード品質**: **92/100** (+4点)
- **セキュリティ**: **95/100** (+7点)
  - 機密情報管理: **98/100** (+3点)
  - ログ管理: **95/100** (+5点)
  - 依存管理: **95/100** (+10点)
  - 脆弱性対策: **95/100** (+15点)

**軽量性**: **変化なし**（約30MB）✅

---

## 🎯 推奨する実装ロードマップ

### フェーズ1: 品質・セキュリティ向上（即座に実施可能）

**実施項目**:
1. 型ヒントの追加（mypy導入）
2. セキュリティ強化（高優先度）
   - 脆弱性スキャンの自動化
   - SECURITY.mdの拡充
   - ファイルパーミッション推奨値の明記

**期間**: 1〜2週間

**効果**:
- コード品質: +4点
- セキュリティ: +4点
- 総合: +3点

**軽量性**: 影響なし ✅

---

### フェーズ2: セキュリティ強化（中優先度）

**実施項目**:
1. 設定ファイルの検証強化
2. 入力値検証の強化（SSRF対策）
3. 依存パッケージのバージョン固定（要検討）

**期間**: 1週間

**効果**:
- セキュリティ: +3点（合計+7点）
- 総合: +2点（合計+5点）

**軽量性**: ほぼ影響なし ✅

---

### フェーズ3: 拡張性向上（オプション）

**実施項目**:
1. シンプルなプラグイン機構

**条件**:
- シンプルな設計であること
- 軽量性を保つこと（+数KB以内）

**期間**: 1〜2週間

**効果**:
- 拡張性: +5点

**軽量性**: ほぼ影響なし ✅

---

### フェーズ4: 国際化（将来）

**実施項目**:
1. 英語版ドキュメント

**タイミング**:
- 機能が安定してきた（v2.0.0以降？）
- 更新頻度が落ち着いた

**効果**:
- ユーザビリティ: +5点

**軽量性**: 影響なし ✅

---

## 🏆 結論

### Komonの「軽量性」は絶対に守るべき

**推奨する改善**:
- ✅ 型ヒント（影響ゼロ）
- ✅ セキュリティ強化（影響ゼロ〜小）
  - 脆弱性スキャン（高優先度）
  - SECURITY.md拡充（高優先度）
  - ファイルパーミッション推奨（高優先度）
  - 検証強化（中優先度）
  - 入力値検証（中優先度）

**オプション**:
- ⚠️ シンプルなプラグイン機構（+数KB、設計次第）

**却下**:
- ❌ Web UI（+50MB以上、理念に反する）
- ❌ チーム開発フロー（+20MB以上、理念に反する）
- ⏸️ 英語版ドキュメント（今は不要、将来検討）

**重要な原則**:
- **軽量性**: 絶対に守る（約30MB）
- **セキュリティ**: 言い訳できない（ユーザーのデータを扱う責任）
- **チーム開発体制・運用体制**: 比較対象外（前提が違う）
- **規模**: 比較対象外（シンプルを追求）

**Komonの強み**は「軽量さ」にあります。これを失うと、既存の大規模監視ツールとの差別化が失われます。

**メモリ使用量: 約30MB** という軽量性を維持しながら、品質・セキュリティ向上を図るのが最適な戦略です。

---

## 🌍 環境対応・拡張性

### [IMPROVE-007] マルチLinuxディストリビューション対応

**カテゴリ**: 環境対応・拡張性  
**提案日**: 2025-11-30  
**ステータス**: アイデア段階  
**優先度**: 中（Phase 2）

#### 背景・課題

**ChatGPTとの対話から生まれた発想**:
- 現在はAlmaLinux 9専用として開発
- Ubuntu 22.04+、Rocky Linux 9+、Amazon Linux 2023+への対応要望
- 企業導入の可能性を広げたい
- ただし、「サポート」ではなく「対象環境の明示」という方針

**現代の課題**:
- Linuxのクライアント利用者が増えている
- Windows→Linux移行者は環境差異に戸惑いがち
- 企業では複数のディストリビューションが混在
- でも全てを「サポート」すると責任範囲が広がりすぎる

#### 改善案

**Phase 1: ドキュメント整備（今すぐ実施可能）**

```markdown
## 対象環境（Recommended Runtime）

Komonは以下の環境での動作を想定しています：

- **Python**: 3.10以上
- **OS**: systemdが使えるLinux
  - AlmaLinux 9+
  - Rocky Linux 9+
  - Ubuntu 22.04+
  - Amazon Linux 2023+

**注意**: 上記以外の環境でも動作する可能性がありますが、
動作保証はしていません。

**対象外**:
- Amazon Linux 2（Python 2.7標準、サポート寿命が短い）
- CentOS 7以前（systemd未対応またはPython 3.10未対応）
```

**新規ドキュメント**:
1. `docs/RECOMMENDED_RUNTIME.md`
   - 対象環境の詳細
   - 各ディストリビューションでの動作確認状況
   - インストール手順の差異

2. `docs/ENTERPRISE_GUIDE.md`
   - 企業向け導入ガイド
   - 複数サーバでの運用方法
   - トラブルシューティング

3. `docs/AI_DEVELOPMENT_RULES.md`
   - AI成果物のチェックポイント
   - 粒度の判断基準
   - 人間レビューの境界線
   - 「理解に追いつける範囲で進める」原則

**Phase 2: OS抽象化レイヤー（将来実装）**

```python
# src/komon/os_adapter.py
class OSAdapter:
    """OS差分を吸収する抽象化レイヤー"""
    
    @staticmethod
    def get_adapter():
        """実行環境に応じたアダプターを返す"""
        if is_almalinux():
            return AlmaLinuxAdapter()
        elif is_ubuntu():
            return UbuntuAdapter()
        elif is_rocky():
            return RockyLinuxAdapter()
        elif is_amazon_linux():
            return AmazonLinuxAdapter()
        else:
            return GenericLinuxAdapter()
    
    def get_log_command(self):
        """ログ取得コマンドを返す"""
        raise NotImplementedError
    
    def get_disk_usage(self):
        """ディスク使用量を取得"""
        raise NotImplementedError

class AlmaLinuxAdapter(OSAdapter):
    """AlmaLinux用アダプター"""
    
    def get_log_command(self):
        return "journalctl"
    
    def get_disk_usage(self):
        # /proc を読む方式（コマンド依存を減らす）
        return parse_proc_mounts()

class UbuntuAdapter(OSAdapter):
    """Ubuntu用アダプター"""
    
    def get_log_command(self):
        return "journalctl"  # systemd統一
    
    def get_disk_usage(self):
        return parse_proc_mounts()
```

**Phase 3: マルチ環境テスト（Phase 2実装後）**

```yaml
# .github/workflows/multi-env-test.yml
name: Multi-Environment Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    strategy:
      matrix:
        os:
          - almalinux:9
          - rockylinux:9
          - ubuntu:22.04
          - amazonlinux:2023
        python:
          - "3.10"
          - "3.11"
          - "3.12"
    
    runs-on: ubuntu-latest
    container: ${{ matrix.os }}
    
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
      - name: Run tests
        run: |
          python -m pytest tests/ -v
```

#### 影響評価

**Phase 1（ドキュメント整備）**:
- **実行時オーバーヘッド**: ゼロ
- **メモリ使用量**: 変化なし
- **依存パッケージ**: 変化なし
- **軽量性**: 影響なし ✅

**Phase 2（OS抽象化レイヤー）**:
- **実行時オーバーヘッド**: 無視できる（if文の分岐のみ）
- **メモリ使用量**: +数KB〜数十KB
- **依存パッケージ**: 変化なし
- **軽量性**: ほぼ影響なし ✅

**Phase 3（マルチ環境テスト）**:
- **実行時オーバーヘッド**: ゼロ（CI/CDのみ）
- **本番環境**: 影響なし
- **軽量性**: 影響なし ✅

#### 実装ステップ

**Phase 1（今すぐ実施可能）**:
1. `docs/RECOMMENDED_RUNTIME.md` 作成
2. `docs/ENTERPRISE_GUIDE.md` 作成
3. `docs/AI_DEVELOPMENT_RULES.md` 作成
4. `README.md` に対象環境を明記
5. 「サポート」ではなく「想定環境」と明記

**Phase 2（将来実装）**:
1. `src/komon/os_adapter.py` の設計
2. `AlmaLinuxAdapter` 実装（既存コードの移行）
3. `UbuntuAdapter` 実装
4. `RockyLinuxAdapter` 実装
5. `AmazonLinuxAdapter` 実装
6. ログ取得部分の強化（journalctl統一）
7. ディスク・メモリ・CPU取得の抽象化（/proc ベース）

**Phase 3（Phase 2完了後）**:
1. `.github/workflows/multi-env-test.yml` 作成
2. CI/CDマトリックステスト実行
3. 各環境での動作確認
4. 問題があれば修正

#### 期待効果

**Phase 1**:
- 対象環境が明確になる
- ユーザーの期待値をコントロール
- 責任範囲が明確になる
- 企業導入の検討材料が増える

**Phase 2**:
- 複数ディストリビューションでの動作が安定
- 環境差異を吸収
- 保守性が向上

**Phase 3**:
- 環境差異による不具合を早期発見
- 品質保証が強化

#### 評価への影響

**Phase 1のみ実施**:
- **ユーザビリティ**: 85/100 → **87/100** (+2点)
  - ドキュメント: 90/100 → **95/100** (+5点)

**Phase 2も実施**:
- **保守性・拡張性**: 87/100 → **92/100** (+5点)
  - 環境対応: 80/100 → **95/100** (+15点)

**Phase 3も実施**:
- **コード品質**: 88/100 → **90/100** (+2点)
  - テスト品質: 95/100 → **98/100** (+3点)

#### 重要な原則

**「サポート」ではなく「対象環境の明示」**:
- ✅ 責任範囲が明確
- ✅ ユーザーの期待値をコントロール
- ✅ 将来の拡張余地を残す
- ❌ 「全てをサポートします」は言わない

**「個人開発の範囲で現実的に」**:
- ✅ Phase 1は今すぐ実施可能（1-2時間）
- ✅ Phase 2は実際に要望が出てから
- ✅ Phase 3は Phase 2実装後
- ❌ 最初から全てを実装しない（YAGNI原則）

---

### [IMPROVE-008] ステアリングルールの企業向け強化

**カテゴリ**: 開発体制・品質保証  
**提案日**: 2025-11-30  
**ステータス**: アイデア段階  
**優先度**: 中（Phase 1と同時実施可能）

#### 背景・課題

**ChatGPTとの対話から生まれた発想**:
- 現在のステアリングルールは個人開発向けに最適化
- 企業導入を視野に入れた品質基準が必要
- AI開発の運用ルールを明文化したい
- 「理解に追いつける範囲で進める」原則の重要性

**現代の課題**:
- AIによる自動コード生成が進化している
- 「完全自走するソフトウェア」の可能性が議論されている
- しかし、**実際に走らせてみた実証例が非常に少ない**
- 企業は「本当に安全にできるの？」に答えられていない

#### 改善案

**新規ステアリングルール**:

**1. `ai-development-rules.md`**
```markdown
# AI開発ルール

## 基本原則

**「理解に追いつける範囲で進める」が最優先**

```
人間の理解速度 > AI の生成速度
```

この原則を守ることで：
- ✅ コードの品質が保たれる
- ✅ 属人化を防げる
- ✅ 長期的なメンテナンス性が保たれる

## AI成果物のチェックポイント

### 自動で進めて良いもの（小さい粒度）
- ✅ タイポ修正
- ✅ インポート追加
- ✅ 型ヒント追加
- ✅ ドキュメント更新
- ✅ テストケース追加

### 人間の確認が必要なもの（中程度の粒度）
- ⚠️ 新規関数の追加
- ⚠️ 既存関数の変更
- ⚠️ 設定ファイルの変更
- ⚠️ 依存パッケージの追加

### 必ず人間が理解してから進めるもの（大きい粒度）
- ❌ 新規モジュールの追加
- ❌ アーキテクチャの変更
- ❌ 既存機能への影響が大きい変更
- ❌ セキュリティに関わる変更

## 粒度の判断基準

**小さい粒度の条件**:
- 変更が10行以内
- 影響範囲が1ファイル以内
- テストで検証可能
- ロールバックが容易

**中程度の粒度の条件**:
- 変更が10〜50行
- 影響範囲が2〜3ファイル
- 既存機能への影響が小さい
- テストで検証可能

**大きい粒度の条件**:
- 変更が50行以上
- 影響範囲が4ファイル以上
- 既存機能への影響が大きい
- アーキテクチャに関わる

## 人間レビューの境界線

**自動で進めて良い条件**:
- 全テストがパス
- カバレッジが維持または向上
- 既存機能への影響がない
- ロールバックが容易

**人間レビューが必須な条件**:
- テストが失敗する
- カバレッジが低下する
- 既存機能への影響がある
- セキュリティに関わる

## 実装時の注意点

**段階的に進める**:
1. 小さく実装
2. テストで検証
3. 動作確認
4. 次の小さな実装へ

**いつでも中断・再開できるように**:
- タスクを小さく分割
- 各タスクで完結させる
- コミットを細かく

**理解できない部分は止まる**:
- AIの提案を盲目的に受け入れない
- 理解できるまで質問する
- 必要なら別の方法を検討
```

**2. `multi-environment-support.md`**
```markdown
# マルチ環境サポート方針

## 基本方針

**「サポート」ではなく「対象環境の明示」**

## 対象環境の定義

### 想定環境（Recommended Runtime）
- Python 3.10以上
- systemdが使えるLinux
- AlmaLinux 9+、Rocky Linux 9+、Ubuntu 22.04+、Amazon Linux 2023+

### 対象外環境
- Amazon Linux 2（Python 2.7標準）
- CentOS 7以前（systemd未対応）
- Windows、macOS（将来検討）

## 環境差分の吸収方針

### Phase 1: ドキュメント整備
- 対象環境を明記
- 各環境での動作確認状況を記載
- インストール手順の差異を説明

### Phase 2: OS抽象化レイヤー
- OSAdapterパターンで環境差異を吸収
- journalctl統一でログ取得を簡素化
- /proc ベースでリソース取得を統一

### Phase 3: マルチ環境テスト
- CI/CDでマトリックステスト
- 各環境での動作を自動検証
```

**3. `enterprise-quality.md`**
```markdown
# 企業品質基準

## 基本方針

**「個人開発だから」は言い訳にならない**

- チーム開発体制: 比較対象外（前提が違う）
- 運用体制: 比較対象外（前提が違う）
- 規模: 比較対象外（シンプルを追求）
- **セキュリティ: 言い訳できない**（ユーザーのデータを扱う責任）

## コード品質の統一

### 型ヒント
- 新規コードは必ず型ヒントを付ける
- 既存コードは段階的に追加
- mypyで静的解析

### テスト品質
- カバレッジ90%以上を維持
- プロパティテスト + 統合テスト + ユニットテスト
- 全テストがパスすることを確認

### ドキュメント
- README.mdは常に最新に
- 各機能のSpec文書を維持
- セキュリティガイドを完備

## logging の構造化

### 現状
- print() と logging の使い分けが明確
- ユーザー向けは日本語、開発者向けは英語

### 将来（オプション）
- 構造化ログ（JSON形式）の検討
- ログレベルの統一
- ログローテーションの自動化

## config の schema validation

### 現状
- settings_validator.py で検証
- 3段階閾値の検証
- 後方互換性の維持

### 将来（オプション）
- JSON Schema による厳密な検証
- 設定ファイルのバージョン管理
- マイグレーションスクリプト
```

#### 影響評価

- **実行時オーバーヘッド**: ゼロ（ルールのみ）
- **メモリ使用量**: 変化なし
- **依存パッケージ**: 変化なし
- **軽量性**: 影響なし ✅

#### 実装ステップ

1. `.kiro/steering/ai-development-rules.md` 作成
2. `.kiro/steering/multi-environment-support.md` 作成
3. `.kiro/steering/enterprise-quality.md` 作成
4. `rules-metadata.yml` に追加
5. README.md に新しいルールを記載

#### 期待効果

- AI開発の運用ルールが明確になる
- 企業導入の検討材料が増える
- 「理解に追いつける範囲で進める」原則が共有される
- 品質基準が明確になる

#### 評価への影響

- **開発体制**: 95/100 → **98/100** (+3点)
  - AI開発ルール: 90/100 → **98/100** (+8点)
- **開発ルール**: 90/100 → **95/100** (+5点)
  - ルールの明確性: 85/100 → **95/100** (+10点)

---

### [IMPROVE-009] Komon を教材にした社内標準化

**カテゴリ**: プロジェクトテンプレート化  
**提案日**: 2025-11-30  
**ステータス**: アイデア段階  
**優先度**: 低（Phase 1, 2完了後）

#### 背景・課題

**ChatGPTとの対話から生まれた発想**:
- Komonは「実用ツール」であると同時に「AI開発のベストプラクティス集」
- この開発体制を他のプロジェクトでも再現したい
- テンプレート化すれば、社内標準として展開可能

**Komonの価値**:
```
Komonの価値 = 実用ツール + AI開発のベストプラクティス集
```

現在のKomonは：
- ✅ Spec駆動開発の実例
- ✅ ステアリングルールの実例
- ✅ AI IDEとの協働の実例
- ✅ 品質を保ちながら開発速度を上げる実例

#### 改善案

**1. プロジェクトテンプレート化**

```
komon-template/
├── .kiro/
│   ├── steering/          # ステアリングルール
│   │   ├── _templates/    # テンプレート（汎用）
│   │   └── project-config.yml
│   ├── specs/             # Spec文書
│   │   ├── _templates/
│   │   ├── future-ideas.md
│   │   └── development-improvements.md
│   └── tasks/             # タスク管理
│       ├── _templates/
│       ├── implementation-tasks.md
│       └── completed-tasks.md
├── scripts/               # 検証スクリプト
│   ├── validate_specs.py
│   ├── check_spec_consistency.py
│   └── generate_steering_rules.py
├── tests/                 # テスト構造
│   ├── test_*_properties.py
│   ├── test_*_integration.py
│   └── test_*_unit.py
├── docs/                  # ドキュメント構造
│   ├── CHANGELOG.md
│   ├── CONTRIBUTING.md
│   └── SECURITY.md
└── README.md
```

**2. ドキュメント体系の標準化**

```markdown
# プロジェクトテンプレート

## 必須ドキュメント
- README.md: プロジェクト概要
- CHANGELOG.md: 変更履歴
- SECURITY.md: セキュリティポリシー
- CONTRIBUTING.md: 貢献ガイド

## 推奨ドキュメント
- RECOMMENDED_RUNTIME.md: 対象環境
- ENTERPRISE_GUIDE.md: 企業向けガイド
- AI_DEVELOPMENT_RULES.md: AI開発ルール

## Spec文書
- requirements.yml: 要件定義
- design.yml: 設計書
- tasks.yml: タスクリスト
```

**3. 規約・ルールの社内展開**

```markdown
# 社内標準開発フロー

## 1. アイデア段階
- future-ideas.md に記録
- development-improvements.md に記録

## 2. Spec作成
- requirements.yml 作成
- design.yml 作成
- tasks.yml 作成

## 3. 実装
- 小さく実装
- テストで検証
- ドキュメント更新

## 4. リリース
- バージョン番号決定
- CHANGELOG.md 更新
- タグ作成
```

#### 影響評価

- **Komonへの影響**: なし（別プロジェクトとして展開）
- **軽量性**: 影響なし ✅

#### 実装ステップ

1. Komonの開発体制を文書化
2. テンプレートリポジトリを作成
3. 社内向けガイドを作成
4. 実際に別プロジェクトで試用
5. フィードバックを反映

#### 期待効果

- 他のプロジェクトでも同じ品質を維持
- AI開発のノウハウが共有される
- 開発速度が向上
- 属人化を防げる

#### 評価への影響

- Komonの評価には影響なし（別プロジェクト）
- 社内全体の開発品質が向上

---

## 📝 更新履歴

- 2025-11-30: 初版作成（プロジェクト評価と改善提案）
- 2025-11-30: 環境対応・拡張性セクションを追加（IMPROVE-007, 008, 009）
  - マルチLinuxディストリビューション対応
  - ステアリングルールの企業向け強化
  - Komon を教材にした社内標準化
- 2025-11-30: セキュリティ強化の項目を追加（IMPROVE-003）
  - 「個人開発だから」は言い訳にならないという原則を明記
  - 高優先度・中優先度・低優先度に分類
  - 評価予測を更新（セキュリティ: 88 → 95点）
