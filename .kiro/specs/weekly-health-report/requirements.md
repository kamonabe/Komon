---
title: 週次健全性レポート - 要件定義
feature: weekly-health-report
status: draft
created: 2025-11-22
---

# 週次健全性レポート - 要件定義書

## 概要

この機能は、システム監視のための定期的な健全性レポートを提供します。
管理者がSSHログインせずにシステム状態を確認できるようにし、
特に年末年始などの長期休暇前に有用です。

## 受け入れ基準

### AC-1: 週次レポートの生成
**WHEN** 週次レポートスクリプトが実行されたとき、  
**THEN** システムは以下を含むレポートを生成すること:
- 現在のリソース使用率（CPU、メモリ、ディスク）
- 先週比の比較（変化率）
- 過去7日間の警戒情報サマリー
- トレンド分析（安定/増加傾向/減少傾向）

### AC-2: 履歴データの収集
**WHEN** 週次レポートを生成するとき、  
**THEN** システムは以下を収集・分析すること:
- 過去7日間のリソース使用率データ
- 前週の平均値（比較用）
- 通知履歴からの警戒情報

### AC-3: Slack通知との統合
**IF** 設定でSlack通知が有効になっている場合、  
**THEN** システムは設定されたSlack Webhook URLに週次レポートを送信すること。

### AC-4: メール通知との統合
**IF** 設定でメール通知が有効になっている場合、  
**THEN** システムは設定されたメールアドレスに週次レポートを送信すること。

### AC-5: 設定の制御
**WHEN** ユーザーが週次レポート設定を行うとき、  
**THEN** システムは以下をサポートすること:
- 週次レポートの有効/無効の切り替え
- レポート生成の曜日と時刻の設定
- 通知チャネルの選択（Slack/メール/両方）

### AC-6: Cronスケジューリング
**WHEN** ユーザーがcronスケジューリングを設定するとき、  
**THEN** システムは以下を提供すること:
- 週次実行のためのcron設定例
- スケジューリング設定のドキュメント
- デフォルト推奨: 毎週月曜日9時

## 非機能要件

### NFR-1: パフォーマンス
- レポート生成は10秒以内に完了すること
- 履歴データの取得はシステムパフォーマンスに影響を与えないこと

### NFR-2: 信頼性
- レポート生成は履歴データが不足していても適切に処理すること
- 通知配信の失敗はレポート生成を妨げないこと

### NFR-3: 使いやすさ
- レポート形式はSlack/メールで読みやすいこと
- トレンド指標は明確な視覚的シンボルを使用すること（✅ ⚠️）

### NFR-4: 保守性
- レポートロジックは通知ロジックから分離されていること
- メッセージテンプレートは容易にカスタマイズ可能であること

## スコープ外

- 日次または時間単位のレポート頻度（週次のみ）
- UI経由のカスタムレポートテンプレート
- レポート履歴の保存（現在のレポートのみ送信）
- 複数サーバーの集約

## 依存関係

- 既存の通知システム（Slack/メール）
- `data/usage_history/` の履歴データストレージ
- `data/notifications/` の通知履歴

## 成功指標

- レポート生成成功率 > 99%
- レポート配信は生成後1分以内
- ユーザー満足度: 「健全性確認のためにSSHする必要がない」
