metadata:
  title: 週次健全性レポート - 設計書
  feature: weekly-health-report
  status: implemented
  created: 2025-11-22
  updated: 2025-11-25
  version: "1.0.0"  # Specのバージョン
  last_validated: null  # YYYY-MM-DD or null
  validation_passed: null  # true | false | null
correctness-properties:
- id: P1
  title: データの正確性
  type: invariant
  description: '*任意の*現在値と前回値について、先週比の計算は `((current - previous) / previous) * 100`
    と一致しなければならない'
  validates:
  - AC-001
  - AC-002
  test-strategy: property-based
- id: P2
  title: 日付範囲の正確性
  type: invariant
  description: '*任意の*レポート期間について、常に正確に7日間をカバーしなければならない'
  validates:
  - AC-002
  test-strategy: property-based
- id: P3
  title: トレンド分類
  type: invariant
  description: '*任意の*変化率について、|change| < 5%の場合は''stable''、change >= 5%の場合は''increasing''、change
    <= -5%の場合は''decreasing''と分類されなければならない'
  validates:
  - AC-001
  test-strategy: property-based
- id: P4
  title: 警戒履歴の完全性
  type: invariant
  description: '*任意の*7日間の期間について、期間内の全ての警戒情報がレポートに含まれなければならない'
  validates:
  - AC-001
  - AC-002
  test-strategy: property-based
- id: P5
  title: グレースフルデグラデーション
  type: invariant
  description: '*任意の*履歴データ不足について、レポート生成を妨げず「データ不足」と表示しなければならない'
  validates:
  - AC-002
  test-strategy: property-based
- id: P6
  title: Slack通知との統合
  type: invariant
  description: '*任意の*週次レポートについて、Slack通知が有効な場合は正しくフォーマットされたメッセージが送信されること'
  validates:
  - AC-003
  test-strategy: integration
- id: P7
  title: メール通知との統合
  type: invariant
  description: '*任意の*週次レポートについて、メール通知が有効な場合は正しくフォーマットされたメールが送信されること'
  validates:
  - AC-004
  test-strategy: integration
- id: P8
  title: 設定による制御
  type: invariant
  description: '*任意の*設定値について、週次レポートの有効/無効、通知先、フォーマットが正しく反映されること'
  validates:
  - AC-005
  test-strategy: property-based
- id: P9
  title: Cronスケジューリング
  type: invariant
  description: '*任意の*cron設定について、週次レポートが指定された時刻に自動実行されること'
  validates:
  - AC-006
  test-strategy: integration
