---
title: Komon - Implementation Task List
status: active
created: 2025-11-22
updated: 2025-11-26
---

# Komon 実装タスクリスト

このドキュメントは、`specs/future-ideas.md` のアイデアを実装可能なタスクに分解し、進捗を管理します。

**注意**: 完了したタスク（v1.16.0以前）は `completed-tasks.md` に移動されています。

---

## タスクステータス

- 🔴 **TODO**: 未着手
- 🟡 **In Progress**: 実装中
- 🟢 **Done**: 完了
- ⏸️ **On Hold**: 保留中
- ❌ **Cancelled**: キャンセル

---

## 🔥 High Priority Tasks

### [TASK-001] 段階的な通知メッセージの実装
**元アイデア**: [IDEA-001] 通知メッセージの改善  
**ステータス**: 🟢 Done  
**優先度**: High  
**見積もり**: 中（4-6時間）  
**完了日**: 2025-11-26 (v1.17.0)

#### 背景
v1.10.1で通知メッセージの口調改善は完了。次のステップとして、通知履歴を持って段階的な表現を切り替える仕組みを実装する。

#### タスク分解
- [x] 通知履歴を活用する仕組みの設計
  - 既存の通知履歴機能（v1.11.0）を活用
  - 保存場所: `data/notifications/queue.json`
  - 保存内容: タイムスタンプ、通知タイプ、メトリクス値
- [x] 履歴から同一問題の繰り返し回数を判定するロジック
  - 時間窓: 直近24時間以内
  - 同一問題の定義: 同じメトリクスタイプ（CPU/メモリ/ディスク）
- [x] 段階的メッセージテンプレートの作成
  - 1回目: 「ちょっと気になることがあります」
  - 2回目: 「まだ続いてますね」
  - 3回目以降: 「そろそろ見た方がいいかも」
- [x] `src/komon/progressive_message.py` の作成
- [x] `src/komon/analyzer.py` の修正
- [x] テストケースの追加
  - プロパティベーステスト: 5件
  - ユニットテスト: 19件
  - 統合テスト: 6件
- [x] ドキュメント更新（README.md, CHANGELOG.md）

#### 完了条件
- ✅ 同一問題が繰り返し発生した際、段階的に表現が変わる
- ✅ 既存テストが全てPASS（268テスト）
- ✅ 新規テストが追加され、カバレッジ93%を維持

#### 実装詳細
- `src/komon/progressive_message.py` を新規作成
- `src/komon/analyzer.py` に`use_progressive`パラメータを追加
- `config/settings.yml.sample` に`progressive_notification`セクションを追加
- プロパティベーステスト5件、ユニットテスト19件、統合テスト6件を追加
- 全268テストがパス、カバレッジ93%を維持

#### 依存関係
- なし（独立して実装可能）

---

### [TASK-003] コンテキストに応じた具体的アドバイス
**元アイデア**: [IDEA-003] コンテキストに応じた具体的アドバイス  
**ステータス**: 🔴 TODO  
**優先度**: High  
**見積もり**: 大（8-12時間）

#### 背景
現状は「メモリ使用率が高いです」と伝えるだけ。プロセス情報に基づいて具体的なアクションを提案する。

#### タスク分解
- [ ] プロセス情報の取得強化
  - `src/komon/monitor.py` でプロセス名、PID、メモリ使用量を取得
  - 上位3-5プロセスを特定
- [ ] パターンマッチングロジックの実装
  - プロセス名からパターン認識（node, docker, python等）
  - 各パターンに対応する提案テンプレート
- [ ] 提案メッセージテンプレートの作成
  - node系: 開発サーバー停止の提案
  - docker系: 不要コンテナの確認提案
  - python系: 学習プロセスの確認提案
- [ ] `src/komon/analyzer.py` に提案ロジックを追加
- [ ] 設定ファイルで提案の詳細度を調整可能に
  - `settings.yml` に `advice_level: minimal/normal/detailed` を追加
- [ ] テストケースの追加
  - 各パターンの提案テスト
  - 設定による動作変更のテスト
- [ ] ドキュメント更新

#### 完了条件
- 閾値超過時に上位プロセスと具体的な提案が表示される
- パターン認識が正しく機能する
- 設定で詳細度を変更できる
- 既存テストが全てPASS

#### 依存関係
- なし（独立して実装可能）

---

### [TASK-004] Slack通知にプロセス名を含める
**元アイデア**: [IDEA-009] Slack通知にプロセス名を含める  
**ステータス**: 🔴 TODO  
**優先度**: Medium  
**見積もり**: 小（2-3時間）

#### 背景
Slack通知で、どのプロセスが高負荷を引き起こしているのかが一目で分かるようにする。

#### タスク分解
- [ ] `scripts/main.py` の通知処理を拡張
  - CPU/メモリ超過時に上位プロセス情報を取得
  - メッセージフォーマットに追加
- [ ] `src/komon/monitor.py` のプロセス情報取得を活用
- [ ] Slackメッセージフォーマットの調整
  - 上位3プロセスを表示
  - プロセス名と使用率を含める
- [ ] テストケースの追加
  - プロセス情報付き通知のテスト
- [ ] ドキュメント更新

#### 完了条件
- Slack通知に上位プロセス情報が含まれる
- 既存の通知機能に影響がない
- テストが追加され、カバレッジが維持される

#### 依存関係
- TASK-003と並行実装可能（同じプロセス情報取得ロジックを共有）

---

## 💡 Medium Priority Tasks

### [TASK-005] 継続実行中プロセスの検出
**元アイデア**: [IDEA-010] 継続実行中プロセスの検出  
**ステータス**: 🔴 TODO  
**優先度**: Medium  
**見積もり**: 中（4-5時間）

#### 背景
特定スクリプトがまだ終了していない場合に、継続稼働を助言表示。

#### タスク分解
- [ ] `scripts/advise.py` に検出ロジックを追加
  - `psutil` でプロセス一覧を走査
  - `cmdline` で対象スクリプト名を確認
  - 実行時間を計算
- [ ] 検出対象スクリプトの定義
  - 設定ファイルで指定可能に
  - デフォルト: `.py`, `.sh` 等
- [ ] 助言メッセージの作成
  - 実行時間が長いプロセスを表示
  - cron間隔との比較提案
- [ ] テストケースの追加
- [ ] ドキュメント更新

#### 完了条件
- 長時間実行中のスクリプトが検出される
- `komon advise` で表示される
- 設定で対象スクリプトを指定できる

#### 依存関係
- なし

---

### [TASK-006] 多重実行プロセスの検出
**元アイデア**: [IDEA-011] 多重実行プロセスの検出  
**ステータス**: 🔴 TODO  
**優先度**: Medium  
**見積もり**: 中（3-4時間）

#### 背景
cronなどによる同一スクリプトの多重起動を検出し、リソース圧迫の原因として助言。

#### タスク分解
- [ ] `src/komon/monitor.py` または `scripts/advise.py` に検出ロジックを追加
  - `cmdline` で同一スクリプトをカウント
  - 閾値（デフォルト: 3個以上）で警告
- [ ] 警告メッセージの作成
- [ ] 設定ファイルで閾値を調整可能に
- [ ] テストケースの追加
- [ ] ドキュメント更新

#### 完了条件
- 同一スクリプトの多重実行が検出される
- 設定で閾値を変更できる
- テストが追加される

#### 依存関係
- TASK-005と並行実装可能（同じプロセス走査ロジックを共有）

---

### [TASK-007] ログ急増時の末尾抜粋表示
**元アイデア**: [IDEA-012] ログ急増時の末尾抜粋表示  
**ステータス**: 🔴 TODO  
**優先度**: Medium  
**見積もり**: 小（2-3時間）

#### 背景
ログ急増の通知時、行数だけでなく実際のログ末尾も数行添付。

#### タスク分解
- [ ] `scripts/main_log_monitor.py` を拡張
  - ログファイルの末尾10行を取得
  - Slack通知メッセージに追加
- [ ] メッセージフォーマットの調整
  - コードブロックで見やすく表示
- [ ] 設定で表示行数を調整可能に
- [ ] テストケースの追加
- [ ] ドキュメント更新

#### 完了条件
- ログ急増通知に末尾抜粋が含まれる
- 設定で行数を変更できる
- 既存機能に影響がない

#### 依存関係
- なし

---

## 🔮 Low Priority / Future Tasks

### [TASK-008] 学習機能（パターン認識）
**元アイデア**: [IDEA-002] 学習機能（パターン認識）  
**ステータス**: ⏸️ On Hold  
**優先度**: Low  
**見積もり**: 大（20時間以上）

#### 背景
ユーザーの行動パターンを学習して、不要な通知を減らす。

#### 検討事項
- 実装難易度が高い
- Komonの「シンプル」思想と相反する可能性
- まずは他の高優先度タスクを完了させてから検討

---

### [TASK-009] 週次レポート機能
**元アイデア**: [IDEA-004] 週次レポート機能  
**ステータス**: 🔴 TODO  
**優先度**: Low  
**見積もり**: 中（6-8時間）

#### 背景
週に1回、振り返りレポートを送信。

#### タスク分解（概要のみ）
- [ ] 週次データの集計ロジック
- [ ] レポートメッセージの作成
- [ ] cron設定の追加
- [ ] 設定で有効/無効を切り替え可能に

---

### [TASK-010] トレンド予測機能
**元アイデア**: [IDEA-007] トレンド予測機能  
**ステータス**: 🔴 TODO  
**優先度**: Low  
**見積もり**: 大（10-15時間）

#### 背景
過去のトレンドから将来を予測。

#### 検討事項
- 予測アルゴリズムの精度が課題
- まずは基本機能を充実させてから検討

---

### [TASK-011] トップ3増加ログの可視化
**元アイデア**: [IDEA-013] トップ3増加ログの可視化  
**ステータス**: 🔴 TODO  
**優先度**: Low  
**見積もり**: 中（5-7時間）

#### 背景
ログ傾向分析の結果を「通知」だけでなく「魅せる」方向へ進化。

#### 検討事項
- matplotlib依存の追加が必要
- Komonの「軽量」思想とのバランスを考慮

---

## 実装ワークフロー

```
1. future-ideas.md でアイデアを検討
   ↓
2. 実装を決定したら、このファイルにタスク化
   ↓
3. タスクステータスを更新しながら実装
   ↓
4. テスト・レビュー
   ↓
5. ステータスを 🟢 Done に更新
   ↓
6. CHANGELOG.md に記録
   ↓
7. future-ideas.md のステータスを「実装済み」に更新
```

---

## 優先順位の判断基準

**High Priority**:
- ユーザー体験を大きく改善する
- 実装コストが低〜中程度
- Komonの思想を強化する
- 既存機能との親和性が高い

**Medium Priority**:
- 便利だが必須ではない
- 実装コストが中程度
- 特定のユースケースで有用

**Low Priority**:
- 実装コストが高い
- 効果が不確実
- まずは他の機能を優先すべき

---

## アーカイブルール

- 次のバージョンがリリースされたら、前バージョンの完了タスクを `completed-tasks.md` に移動
- 直近バージョン（v1.17.0）の完了タスクはこのファイルに残す
- アーカイブは `completed-tasks.md` でバージョン降順に整理

## 更新履歴

- 2025-11-26: タスクリストをアーカイブ方式に変更、v1.16.0以前の完了タスクを `completed-tasks.md` に移動
- 2025-11-25: TASK-015を完了に更新（v1.16.0）
- 2025-11-24: TASK-014を完了に更新（v1.15.0）
- 2025-11-23: TASK-016を完了に更新（v1.14.0）
- 2025-11-23: TASK-013を完了に更新（v1.13.0）
- 2025-11-22: 年末年始の健全確認対応として4タスクを追加（TASK-012〜015）
- 2025-11-22: TASK-002を完了に更新（v1.11.0）
- 2025-11-22: 初版作成（future-ideas.md から11タスクを抽出）
