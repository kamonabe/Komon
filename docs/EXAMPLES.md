# Komon 出力例とユースケース

このドキュメントでは、Komonの実際の出力例と、具体的なユースケースを紹介します。

---

## 📖 目次

- [基本的な使い方](#-基本的な使い方)
- [リソース監視の出力例](#-リソース監視の出力例)
- [ログ傾向分析の出力例](#-ログ傾向分析の出力例)
- [ディスク使用量予測の出力例](#-ディスク使用量予測の出力例)
- [週次健全性レポートの出力例](#-週次健全性レポートの出力例)
- [通知履歴の出力例](#-通知履歴の出力例)
- [Slack通知の例](#-slack通知の例)
- [ユースケース](#-ユースケース)

---

## 🚀 基本的な使い方

### 対話型アドバイザー（推奨）

```bash
$ python scripts/advise.py
# または
$ komon advise
```

システムの状態を分析して、改善提案を対話的に表示します。

### リソース監視（バックグラウンド実行）

```bash
$ python scripts/main.py
```

CPU、メモリ、ディスクの使用率を監視し、閾値を超えた場合に通知します。

### ステータス確認

```bash
$ python scripts/status.py
# または
$ komon status
```

現在のシステム状態を表示します。

---

## 📊 リソース監視の出力例

### 正常な状態

```bash
$ komon advise

🔔 警戒情報
（なし）

💡 改善提案

① セキュリティパッチの確認
→ セキュリティ更新はありません。

② システムパッチ（セキュリティ以外）の確認
→ セキュリティ以外の更新が 12 件あります。例：
   - python3.x86_64                      3.11.9-7.el9_5.1                     appstream
   - python3-libs.x86_64                 3.11.9-7.el9_5.1                     appstream
   ...

💡 以下のコマンドでこれらをまとめて適用できます：
   sudo dnf upgrade -y

📌 CPU使用率の内訳：
- systemd: 0.1%
- kthreadd: 0.0%
- python: 2.3%

📌 メモリ使用率の内訳：
- firewalld: 41.4 MB
- python: 30.4 MB
- polkitd: 22.7 MB
- NetworkManager: 18.9 MB

🧐 高負荷プロセスの詳細情報（CPU使用率が高いもの）
→ 現在、高負荷なプロセスは検出されていません。
```

### 警告が発生している状態

```bash
$ komon advise

🔔 警戒情報

💛 警告: CPU使用率が高めです（72.3%）
そろそろ気にかけておいた方がいいかもしれません。

💡 改善提案

① セキュリティパッチの確認
→ セキュリティ更新はありません。

② システムパッチ（セキュリティ以外）の確認
→ 更新はありません。

📌 CPU使用率の内訳：
- python: 45.2%
- node: 18.7%
- docker: 8.4%

📌 メモリ使用率の内訳：
- python: 512.3 MB
- node: 387.1 MB
- docker: 256.8 MB

🧐 高負荷プロセスの詳細情報（CPU使用率が高いもの）

プロセス: python (PID: 12345)
- CPU使用率: 45.2%
- メモリ使用量: 512.3 MB
- コマンドライン: python scripts/heavy_task.py
- 実行時間: 00:15:32

プロセス: node (PID: 23456)
- CPU使用率: 18.7%
- メモリ使用量: 387.1 MB
- コマンドライン: node server.js
- 実行時間: 02:34:12
```

### 緊急状態

```bash
$ komon advise

🔔 警戒情報

❤️ 緊急: メモリ使用率がかなり逼迫しています！（92.5%）
早急な対応が必要です。

🧡 警戒: ディスク使用率がちょっと気になる水準です（83.2%）

💡 改善提案

① セキュリティパッチの確認
→ セキュリティ更新はありません。

② システムパッチ（セキュリティ以外）の確認
→ 更新はありません。

📌 CPU使用率の内訳：
- python: 12.3%
- systemd: 0.1%

📌 メモリ使用率の内訳：
- python: 2.1 GB
- docker: 1.8 GB
- postgres: 1.2 GB

🧐 高負荷プロセスの詳細情報（CPU使用率が高いもの）
→ 現在、高負荷なプロセスは検出されていません。
```

---

## 📈 ログ傾向分析の出力例

### 正常な状態

```bash
$ komon advise

📈 ログ傾向分析
📊 /var/log/messages: 正常範囲（前日比 +2.1%）
📊 /var/log/httpd/access_log: 正常範囲（前日比 -1.3%）
```

### ログ急増を検知

```bash
$ komon advise

📈 ログ傾向分析
📊 /var/log/messages: 前日比 +45.2% の急増の可能性
📊 /var/log/httpd/error.log: 前日比 +78.5% の急増の可能性
📊 /var/log/httpd/access_log: 正常範囲（前日比 +3.2%）

💡 推奨アクション：
- ログファイルを確認してください: tail -f /var/log/messages
- エラーの原因を調査してください
```

---

## 📊 ディスク使用量予測の出力例

### 安定している状態

```bash
$ komon advise

📊 ディスク使用量の予測
✅ ディスク使用量は安定しています
現在の使用率: 68.5%
増加率: +0.3%/日

当面は問題ありません。
```

### 急増を検知

```bash
$ komon advise

📊 ディスク使用量の予測
⚠️ ディスク使用量が急激に増加しています！
前日比: +12.5%（75.0% → 87.5%）

このままだと、あと3日で90%に到達する見込みです。
予測到達日: 2025-11-28

💡 推奨アクション：
- 古いログファイルを削除: journalctl --vacuum-time=7d
- 不要なファイルを確認: du -sh /* | sort -h
- Dockerイメージをクリーンアップ: docker system prune -a
```

### 90%到達が近い状態

```bash
$ komon advise

📊 ディスク使用量の予測
🚨 ディスク使用量が90%に近づいています！
現在の使用率: 88.2%
増加率: +1.2%/日

このままだと、あと2日で90%に到達する見込みです。
予測到達日: 2025-11-27

💡 推奨アクション：
- 緊急: 不要なファイルを削除してください
- ログローテーションを確認: logrotate -f /etc/logrotate.conf
- 大きなファイルを探す: find / -type f -size +100M 2>/dev/null
```

---

## 📅 週次健全性レポートの出力例

### Slack通知の例

```
📊 週次健全性レポート（2025-11-18 〜 2025-11-24）

【リソース使用状況】
CPU平均: 45.2% (先週比: +3.1%)
メモリ平均: 68.5% (先週比: +1.2%)
ディスク平均: 72.3% (先週比: +0.8%)

【トレンド判定】
CPU: 増加傾向 📈
メモリ: 安定 ➡️
ディスク: 安定 ➡️

【今週の警戒情報】
- 11/20 15:30: CPU使用率が高めです（85.2%）
- 11/22 09:15: メモリ使用率が高めです（82.1%）

【ディスク使用量予測】
✅ ディスク使用量は安定しています
現在の使用率: 72.3%
増加率: +0.3%/日

【ログ傾向】
/var/log/messages: 正常範囲（前日比 +2.1%）
/var/log/httpd/access_log: 正常範囲（前日比 -1.3%）

【推奨アクション】
- CPU使用率が増加傾向です。不要なプロセスを確認してください。
- システムパッチが12件あります。適用を検討してください。
```

---

## 📜 通知履歴の出力例

### 全履歴を表示

```bash
$ komon advise --history

📜 通知履歴

💾 [2025-11-24 15:30:45] MEM: 82.1 - メモリ使用率が高めです
🔥 [2025-11-24 09:15:23] CPU: 85.2 - CPU使用率が高めです
💾 [2025-11-22 21:01:28] MEM: 85.0 - Test alert
📝 [2025-11-22 21:01:27] LOG: 1000.0 - Test email alert
💾 [2025-11-22 20:59:08] MEM: 85.0 - Test alert
🔥 [2025-11-20 14:23:12] CPU: 92.3 - CPU使用率がかなり逼迫しています
💾 [2025-11-18 10:45:33] MEM: 78.5 - メモリ使用率が高めです
```

### 直近10件のみ表示

```bash
$ komon advise --history 10

📜 通知履歴（直近10件）

💾 [2025-11-24 15:30:45] MEM: 82.1 - メモリ使用率が高めです
🔥 [2025-11-24 09:15:23] CPU: 85.2 - CPU使用率が高めです
💾 [2025-11-22 21:01:28] MEM: 85.0 - Test alert
📝 [2025-11-22 21:01:27] LOG: 1000.0 - Test email alert
💾 [2025-11-22 20:59:08] MEM: 85.0 - Test alert
🔥 [2025-11-20 14:23:12] CPU: 92.3 - CPU使用率がかなり逼迫しています
💾 [2025-11-18 10:45:33] MEM: 78.5 - メモリ使用率が高めです
🔥 [2025-11-16 08:12:45] CPU: 88.7 - CPU使用率が高めです
💾 [2025-11-14 16:34:21] MEM: 81.2 - メモリ使用率が高めです
💿 [2025-11-12 11:23:56] DISK: 83.5 - ディスク使用率が高めです
```

---

## 💬 Slack通知の例

### 警告レベル

```
💬 ちょっと気になることがあります

CPUが頑張りすぎてるみたいです（72.3%）。
そろそろ気にかけておいた方がいいかもしれません。
```

### 警戒レベル

```
💬 ちょっと気になることがあります

メモリ使用率がちょっと気になる水準です（83.2%）。
何か重い処理走ってます？
```

### 緊急レベル

```
💬 緊急のお知らせ

CPUがかなり逼迫しています！（92.5%）
早急な対応が必要です。

プロセス詳細:
- python (PID: 12345): 45.2%
- node (PID: 23456): 18.7%
- docker (PID: 34567): 8.4%
```

### ログ急増の通知

```
💬 ログ急増を検知しました

/var/log/messages: 前日比 +45.2% の急増
/var/log/httpd/error.log: 前日比 +78.5% の急増

推奨アクション:
- ログファイルを確認してください
- エラーの原因を調査してください
```

### ディスク使用量予測の通知

```
💬 ディスク使用量の警告

ディスク使用量が急激に増加しています！
前日比: +12.5%（75.0% → 87.5%）

このままだと、あと3日で90%に到達する見込みです。
予測到達日: 2025-11-28

推奨アクション:
- 古いログファイルを削除
- 不要なファイルを確認
- Dockerイメージをクリーンアップ
```

---

## 🎯 ユースケース

### ユースケース1: 開発サーバーの監視

**状況**: 個人開発者が自宅サーバーで複数のプロジェクトを開発中

**Komonの活用**:
- 5分おきにリソース監視（`main.py`）
- 開発中のコードがメモリリークを起こしていないか確認
- ディスク使用量が急増したら通知（ログファイルの肥大化を検知）

**効果**:
- メモリリークを早期発見し、修正
- ディスク容量不足によるビルド失敗を未然に防止
- 開発に集中できる（監視は自動化）

### ユースケース2: 小規模チームの開発環境

**状況**: 3人のチームで共有開発サーバーを使用

**Komonの活用**:
- Slack通知を有効化
- 週次健全性レポートで定期的に状態を把握
- 誰かが重い処理を実行したら、チーム全員に通知

**効果**:
- サーバーの状態をチーム全員が把握
- リソース不足による開発停止を防止
- 「誰が重い処理を実行しているか」が分かる

### ユースケース3: VPSでのWebアプリ運用

**状況**: 個人開発者がVPSでWebアプリを運用中

**Komonの活用**:
- ログ傾向分析でアクセス急増を検知
- ディスク使用量予測で容量不足を事前に把握
- 通知頻度制御で「通知疲れ」を防止

**効果**:
- アクセス急増を早期発見し、スケールアップを検討
- ディスク容量不足によるサービス停止を未然に防止
- 適切なタイミングで通知を受け取れる

### ユースケース4: CI/CDパイプラインの監視

**状況**: GitHub Actionsで自動テストを実行中

**Komonの活用**:
- テスト実行後にリソース使用状況を確認
- メモリリークやディスク使用量の増加を検知
- 週次レポートでトレンドを把握

**効果**:
- テストの実行時間が長くなる原因を特定
- リソース使用量の増加傾向を早期発見
- パフォーマンス改善の指標として活用

### ユースケース5: 既存監視ツールとの併用

**状況**: 本番環境でZabbixを使用中、開発環境でKomonを併用

**Komonの活用**:
- 開発環境専用の軽量監視
- 開発者目線の「やさしい通知」
- プロセス単位の細かい監視

**効果**:
- 大規模監視では拾いきれない「開発者目線の気づき」を取得
- 開発環境と本番環境で異なる監視戦略を実現
- 軽量なので既存ツールと競合しない

---

## 📝 まとめ

Komonは、開発者のための軽量アドバイザー型ツールです。

- **やさしい通知**: 技術的すぎない、人間らしい表現
- **段階的な警告**: 3段階閾値で通知疲れを防止
- **予測機能**: ディスク使用量の予測で事前に対策
- **履歴管理**: 通知履歴で過去の状態を確認
- **週次レポート**: 定期的にシステムの状態を把握

詳細は [README.md](../README.md) を参照してください。
